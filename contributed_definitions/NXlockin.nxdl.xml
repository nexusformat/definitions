<?xml version='1.0' encoding='UTF-8'?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<!--
# NeXus - Neutron and X-ray Common Data Format
#
# Copyright (C) 2014-2024 NeXus International Advisory Committee (NIAC)
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" category="base" type="group" name="NXlockin" extends="NXobject" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <doc>
         A base class definition for a lock-in amplifier.
         
         The lock-in amplifier information: the device is being used to extract a (potentially)
         very weak input signal buried in the noisy background, where the input signal has
         the same frequency (or its harmonic) as a known reference signal. Additionally,
         the phase shift between the input signal and the reference signal is measured.
         The reference signal might be created by a generator built-in into the lock-in amplifier.
    </doc>
    <group name="hardware" type="NXfabrication">
        <doc>
             Hardware manufacturers and type of lock-in amplifier.
        </doc>
    </group>
    <group type="NXamplifier">
        <doc>
             Description of the amplifier (after detection of the signal from the noise)
        </doc>
    </group>
    <field name="bias_divider">
        <doc>
             Bias divider for lock-in channel if if has.
             Bias divider = V(ref)/[V(ref)+V(input)]
        </doc>
    </field>
    <field name="modulation_status" type="NX_BOOLEAN">
        <doc>
             Switch the lock-in modulation on or off.
        </doc>
    </field>
    <field name="modulation_signal" type="NX_CHAR">
        <doc>
             A periodic voltage signal generated by the lock-in,
             usually applied to a sample and used to create a reference signal for the detection of the input signal
        </doc>
    </field>
    <field name="lockin_current_flip_value" type="NX_NUMBER" optional="true">
        <doc>
             The number that defines the sign of the lock-in current. The calibration procedure
             with retracted tip is normally performed to compensate for the signal phase delay
             in SPM. The procedure yields two possible solutions, this number should be equal
             to 1 or -1 depending on which solution is chosen.
        </doc>
    </field>
    <!--(For bais modulate signal, it depands on the modulate type)-->
    <!--unit could be NX_VOLTAGE or NX_CURRENT-->
    <field name="reference_amplitude" type="NX_NUMBER" units="NX_ANY">
        <doc>
             Amplitude of the reference signal for the lock-in amplifier.
        </doc>
    </field>
    <field name="reference_frequency" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
             Frequency of the reference signal for the lock-in amplifier.
        </doc>
    </field>
    <field name="reference_phase" type="NX_NUMBER" units="NX_ANGLE">
        <doc>
             Phase of the reference signal for the lock-in amplifier.
        </doc>
    </field>
    <field name="demodulated_signal" type="NX_CHAR">
        <doc>
             The modulated output signal will be demodulated, in order to determine the amplitude
             and phase at the frequency set in the Frequency field or harmonics, such as current,
             bias, et.al.
        </doc>
    </field>
    <field name="demodulated_frequency" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
             The frequency of the demodulated signal.
        </doc>
    </field>
    <field name="frequency_demodulation_bandwidth" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
             The bandwidth of the modulated signal that can be applied in frequency
             demodulation mechanism.
        </doc>
    </field>
    <!--unit could be NX_VOLTAGE or NX_CURRENT-->
    <field name="demodulated_amplitude" type="NX_NUMBER" units="NX_ANY">
        <doc>
             The amplitude of the demodulated signal.
        </doc>
    </field>
    <field name="amplitude_demodulation_bandwidth" type="NX_NUMBER" units="NX_ANY">
        <doc>
             The bandwidth of the modulated signal that can be applied in amplitude
             demodulation mechanism.
        </doc>
    </field>
    <field name="demodulated_phase" type="NX_NUMBER" units="NX_ANGLE">
        <doc>
             The phase of the demodulated signal.
        </doc>
    </field>
    <field name="phase_demodulation_bandwidth" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
             The bandwidth of the modulated signal that can be applied in phase demodulation
             mechanism.
        </doc>
    </field>
    <field name="demodulator_channels" type="NX_CHAR">
        <doc>
             List of the demodulator channels.
        </doc>
    </field>
    <field name="low_pass_N" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
             Frequency of the low-pass filter applied on the demodulated
             signals (X,Y), cut-off frq (low pass filter) (for each DemodulatorChannels).
        </doc>
    </field>
    <field name="hi_pass_N" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
             Frequency of the high-pass filter applied on the demodulation
             signal cut-off frq (hi pass filter) (for each DemodulatorChannels).
        </doc>
    </field>
    <field name="lp_filter_order_N" type="NX_NUMBER">
        <doc>
             Order of the low-pass filter applied on the demodulated signals (X, Y).
             Reducing the bandwidth or increasing the order reduces noise on the demodulated signals,
             but increases settling and measurement times.
        </doc>
    </field>
    <field name="hp_filter_order_N" type="NX_NUMBER">
        <doc>
             Order of the high-pass filter applied on the demodulation
             signal. This is used mainly to suppress a DC component of the input
             signal noise.
        </doc>
    </field>
    <field name="ref_phase_N" type="NX_NUMBER" units="NX_ANGLE">
        <doc>
             Reference phase of reference signal with respect to the demodulated signal
             (foreach Channels).
        </doc>
    </field>
    <field name="integration_time" type="NX_NUMBER" units="NX_TIME">
        <doc>
             Integration time for the product of the input and the reference signals
        </doc>
    </field>
    <field name="harmonic_order_N" type="NX_NUMBER">
        <doc>
             The reference signal can be a higher harmonic of the modulation signal.
             Here the order of the harmonic is stored.
        </doc>
    </field>
    <field name="sensitivity_factor" type="NX_NUMBER">
        <doc>
             Ratio of output signal amplitude to input signal amplitue (V/V).
        </doc>
    </field>
</definition>
