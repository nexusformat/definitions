<?xml version='1.0' encoding='UTF-8'?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<!--
# NeXus - Neutron and X-ray Common Data Format
#
# Copyright (C) 2014-2025 NeXus International Advisory Committee (NIAC)
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" category="base" type="group" name="NXlockin" extends="NXobject" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <doc>
        A base class definition for a lock-in amplifier.
        
        The lock-in amplifier information: the device is being used to extract a (potentially)
        very weak input signal buried in the noisy background, where the input signal has
        the same frequency (or its harmonic) as carrier signal or reference signal, using heterodyne
        detection.
        
        This method extracts the amplitude and phase shift between input signal and reference signal.
        
        In single phase lock-in amplifiers used in high signal-to-noise ratio applications, only
        the amplitude is measured and phase difference is set to zero.
        
        In two phase lock-in amplifiers used in low signal-to-noise ratio applications, both the
        amplitude and phase difference are measured.
        
        Fields with partial names like low_passN, high_passN, etc., can be repeated for each channel
        of the lockin amplifier. It is envisioned that these fields are named low_pass_0, low_pass_1,
        and so on.
    </doc>
    <group name="hardware" type="NXfabrication">
        <doc>
            Hardware manufacturers and type (product number) of lock-in amplifier.
        </doc>
    </group>
    <field name="bias_divider">
        <doc>
            Bias divider for lock-in channel.
            math: `Bias divider $= \frac{V_{\mathrm{ref}}}{V_{\mathrm{ref}} + V_{\mathrm{input}}}$`
        </doc>
    </field>
    <field name="modulation_status" type="NX_BOOLEAN">
        <doc>
            Switch the lock-in modulation on or off.
        </doc>
    </field>
    <field name="modulation_signal" type="NX_CHAR">
        <doc>
            Type of the modulation or reference signal, voltage | current | bias.
            The name of the current or voltage signal can be also specified
            according to their purpose (e.g., `bias` voltage).
        </doc>
        <enumeration open="true">
            <item value="voltage"/>
            <item value="current"/>
            <item value="bias"/>
        </enumeration>
    </field>
    <field name="modulation_frequency" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
            The frequency of the sine modulation that is used to modulate the signal in
            lock-in.
        </doc>
    </field>
    <field name="reference_amplitude" type="NX_NUMBER" units="NX_ANY">
        <doc>
            Amplitude of the reference signal for the lock-in amplifier.
            Unit could be NX_VOLTAGE or NX_CURRENT depending on the type of the reference signal.
        </doc>
    </field>
    <field name="reference_frequency" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
            Frequency of the reference signal for the lock-in amplifier.
        </doc>
    </field>
    <field name="reference_phase" type="NX_NUMBER" units="NX_ANGLE">
        <doc>
            Phase of the reference signal set in the lock-in amplifier.
        </doc>
    </field>
    <field name="phase_difference" type="NX_NUMBER" units="NX_ANGLE">
        <doc>
            Phase difference between the input signal and the reference signal.
            This is used in two phase lock-in amplifiers.
            In single phase lock-in amplifiers, this value is set to zero.
        </doc>
    </field>
    <field name="demodulated_signal" type="NX_CHAR">
        <doc>
            Type of the demodulated signal,  current | voltage | bias.
            The name of the current or voltage signal can be also specified
            according to their purpose (e.g., `bias` voltage).
        </doc>
        <enumeration open="true">
            <item value="current"/>
            <item value="voltage"/>
            <item value="bias"/>
        </enumeration>
    </field>
    <field name="demodulated_frequency" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
            The frequency of the demodulated signal.
        </doc>
    </field>
    <field name="frequency_modulation_bandwidth" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
            The bandwidth of the modulating signal.
        </doc>
    </field>
    <field name="phase_modulation_bandwidth" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
            The bandwidth of the modulating signal over which modulated signal spreads.
        </doc>
    </field>
    <field name="amplitude_modulation_bandwidth" type="NX_NUMBER" units="NX_FREQUENCY">
        <doc>
            The bandwidth of the modulating signal over which modulated signal spreads.
        </doc>
    </field>
    <field name="demodulated_amplitude" type="NX_NUMBER" units="NX_ANY">
        <doc>
            The amplitude of the demodulated signal.
            Unit could be NX_VOLTAGE or NX_CURRENT depending on the type of the demodulated signal.
        </doc>
    </field>
    <field name="demodulated_phase" type="NX_NUMBER" units="NX_ANGLE">
        <doc>
            The phase of the demodulated signal.
        </doc>
    </field>
    <field name="demodulator_channels" type="NX_CHAR">
        <doc>
            Comma separated list of the demodulator channels.
        </doc>
    </field>
    <field name="low_passN" type="NX_NUMBER" nameType="partial" units="NX_FREQUENCY">
        <doc>
            Frequency of the low-pass filter or cut-off frequency. Only signals below
            this frequency are passed through the filter.
            N is envisioned to represent the channel number e.g., low_pass1.
        </doc>
    </field>
    <field name="high_passN" type="NX_NUMBER" nameType="partial" units="NX_FREQUENCY">
        <doc>
            Frequency of the high-pass filter or cut-off frequency. Only signals above
            this frequency are passed through the filter.
            N is envisioned to represent the channel number e.g., high_pass1.
        </doc>
    </field>
    <field name="lp_filter_orderN" type="NX_NUMBER" nameType="partial">
        <doc>
            Order of the low-pass filter applied on the input or demodulated signals (X, Y).
            Reducing the bandwidth or increasing the order reduces noise on the demodulated signals,
            but increases settling and measurement times.
            N is envisioned to represent the channel number e.g., lp_filter_order1.
        </doc>
    </field>
    <field name="hp_filter_orderN" type="NX_NUMBER" nameType="partial">
        <doc>
            Order of the high-pass filter applied on the input or demodulated
            signal. This is used mainly to suppress a DC component of the input
            signal noise.
            N is envisioned to represent the channel number e.g., hp_filter_order1.
        </doc>
    </field>
    <field name="ref_offset_phaseN" type="NX_NUMBER" nameType="partial" units="NX_ANGLE">
        <doc>
            An extra phase offset added to the reference signal in modulation step.
            N is envisioned to represent the channel number e.g., hp_filter_order1.
        </doc>
    </field>
    <field name="harmonic_orderN" type="NX_NUMBER" nameType="partial">
        <doc>
            The reference signal can be a higher harmonic of the modulation signal.
            Here the order of the harmonic is stored.
            N is envisioned to represent the channel number e.g., harmonic_order1.
        </doc>
    </field>
    <field name="sensitivity_factor" type="NX_NUMBER" units="NX_DIMENSIONLESS">
        <doc>
            Ratio of output signal amplitude to input signal amplitude (V/V).
        </doc>
    </field>
    <field name="dc_offset_valueN" type="NX_NUMBER" nameType="partial" units="NX_ANY">
        <doc>
            The DC offset of the demodulated signal.
            This is used to remove the DC component from the demodulated signal.
            
            The same DC offset might be applied to the input signal in the modulation process.
            N is envisioned to represent the channel number e.g., dc_offset_value1.
        </doc>
    </field>
</definition>
