<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<!--
# NeXus - Neutron and X-ray Common Data Format
# 
# Copyright (C) 2008-2022 NeXus International Advisory Committee (NIAC)
# 
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<definition name="NXstress" extends="NXobject" type="group" category="application"
    xmlns="http://definition.nexusformat.org/nxdl/3.1"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <symbols>
        <symbol name="nX">
            <doc>Number of diffractogram channels.</doc>
        </symbol>
        <symbol name="nD">
            <doc>Number of diffractograms. For example the number of energy-dispersive detectors or the number of azimuthal sections in an area detector.</doc>
        </symbol>
        <symbol name="nPeaks">
            <doc>Number of reflections.</doc>
        </symbol>
        <symbol name="xUnit">
            <doc>Diffractogram X units.</doc>
        </symbol>
        <symbol name="yUnit">
            <doc>Diffractogram Y units.</doc>
        </symbol>
        <symbol name="cUnit">
            <doc>Converted diffractogram X units (could be the same as *xUnit*).</doc>
        </symbol>
    </symbols>
    <doc>
    Application definition for stress and strain analysis of crystalline material defined by the `EASI-STRESS consortium &lt;https://easi-stress.eu&gt;`_.

    When a crystal is loaded (applied or residual stress) its crystallographic parameters change.

    Stress and strain analysis calculates deformation (strain) and the associated force (stress)
    from diffraction data.

    This application definition essentially standardizes the result of diffraction pattern analysis
    from different types of diffraction experiments for the purpose of stress and strain analysis.
    The analysis is typically some form of diffraction peak indexing and fitting.
    The experiments are for example

    - energy-dispersive X-ray powder diffraction
    - angular-dispersive X-ray powder diffraction
    - angular-dispersive neutron powder diffraction
    - time-of-flight (TOF) neutron powder diffraction.

    In addition, the application definition guarantees that the information about instrumental setups, measurement conditions, and data analysis workflows are described.
    This ensures not only the reproducability and tracability of the measured data, but also the meta-data. Since not all participating beamlines or instruments can provide an input to all the NXfields listed in this application definition, not all of them are "required".
    However, when possible and technically feasible, the instrument using the NXstress application definition is expected to provide the type of information outlined below. 

    Sample and detector positions can be defined with :ref:`NXtransformations`. If you don't specify the direction of gravity
    and the direction of the beam then the standard NeXus Coordinate System is used.

    It is highly recommended that in case certain parameters or values are the same for all the measurements (acquistions) in the same
    file, that they are stored only in one location and then linked in the other instances. For example, if during an acquisition all
    instrumental parameters but one stay the same and only the sample table moves in one direction (e.g. Xtranslation), then all the
    static instrumental parameters should be saved just once (e.g. in just one NXentry or in a *Shared_Information group*) and their
    vales linked to every *instrument group* under all the other acquistions. The value for the variable that changes, Xtranslation
    in this example, is suggested to only be saved at every instrument group under each acquistion but not in the *Shared_Information group*.
    It is not always necessary to link each field. In case all the fields with an entire group are the same, the entire group can be linked.
    </doc>

    <group type="NXentry">
        <doc>
            The name of the *NXentry group(s)* can be freely chosen by the facility. The *NXentry group* can contain any form of data acquisition (e.g. a measurement point, multiple measurement points, a line scan, a mesh, all data points from one sample …).
        </doc>
        <field name="definition" type="NX_CHAR">
            <doc> Official NeXus NXDL schema to which this file conforms </doc>
            <enumeration>
                <item value="NXstress" />
            </enumeration>
        </field>
        <field name="title" optional="true">
            <doc>Extended title for the entry.</doc>
        </field>
        <field name="experiment_identifier" optional="true">
            <doc>
                Unique identifier for the experiment as defined by the facility (e.g. DOI, proposal id, ...). At ILL, this could be, for example, ``exp_1-02-286``, ``exp_INDU-229``, or ``exp_INTER-569``.
            </doc>
        </field>
        <field name="experiment_description" optional="true">
            <doc>
                    Brief summary of the experiment, including key objectives. At least one of the following information should be provided:
                        * ``energy-dispersive X-ray powder diffraction``
                        * ``angular-dispersive X-ray powder diffraction``
                        * ``angular-dispersive neutron powder diffraction``
                        * ``time-of-flight (TOF) neutron powder diffraction``
            </doc>
        </field>

        <field name="start_time" type="NX_DATE_TIME" minOccurs="1">
            <doc>
                The starting time(s) of measurement(s) which can be provided in form of a list if multiple measurements are included in the same NXentry.
            </doc>
        </field>
        <field name="end_time" type="NX_DATE_TIME" minOccurs="1">
            <doc>
                The end time(s) of measurement(s) which can be provided in form of a list if multiple measurements are included in the same NXentry.
            </doc>
        </field>

        <field name="collection_identifier" optional="true">
            <doc>
                User or Data Acquisition defined identifier from which
                the content of this application definition is derived. This can be freely chosen by the user or the instrument scientist and could be, for example, ``05_DA_650_AX_B3P5``, ``SENB-14``, ``Quartz``,....
            </doc>
        </field>
        <field name="collection_description" optional="true">
            <doc>
                Brief summary of the collection, including grouping criteria. The information provided in this field can highlight, for example, the measurement setup or information about experimental conditions.
            </doc>       
        </field>
        <field name="diffraction_type" type="NX_CHAR" optional="false">
            <doc>   This variable describes the type of data plotted in the diffractogram and describes the type of calculation used in the EASI-STRESS software. Any of these values are valid:
                     * ``two-theta``
                     * ``energy``
                     * ``d-spacing``
                     * ``sin2psi``
            </doc>
        </field>         
        <field name="measurement_direction" type="NX_CHAR" optional="true">
            <doc>   Describes the specific measurement direction covered by the data in this file. Any of these values are valid:
                     * ``radial``
                     * ``longitudinal``
                     * ``normal``
                     * ``tangential``
                     * ``multiple``
            </doc>
        </field>
        <group name="experiment_responsible" type="NXuser" optional="true">
            <doc>Information about the person who performed the experiment.</doc>
            <field name="name" type="NX_CHAR" optional="true">
            </field>
            <field name="role" type="NX_CHAR" optional="true">
                <doc>Role of user responsible for this entry. Suggested roes are, for example, ``local contact``, ``beamline_scientist``, ``post_doc``,…</doc>
            </field>
        </group>
        <group name="instrument" type="NXinstrument" optional="false">
            <field name="name" type="NX_CHAR" optional="false">
                <doc>Name of the diffractometer, instrument, or beamline used for the experiment. This could be, for example, *Strain Analyser for Large and Small scale engineering Applications*.</doc>
                <attribute name="short_name" optional="true">
                    <doc>Short name for the instrument, perhaps the acronym, which would be for the the example above ``SALSA``.</doc>
                </attribute>
            </field>
            <group name="CALIBRATION" type="NXnote" optional="true">
                <doc>Geometry and/or efficiency measurement(s).</doc>
                <field name="calibration_type" type="NX_CHAR">
                    <doc>Describe the type of calibration</doc>
                </field>
                <field name="file_name" type="NX_CHAR" optional="true">
                    <doc>Name of the calibration file</doc>
                </field>
                <field name="data" type="NX_BINARY" optional="true">
                    <doc>Calibration file content.</doc>
                </field>
                <field name="type" type="NX_CHAR" optional="true">
                    <doc>Mime content type of note *data* field e.g. text/plain, application/json</doc>
                </field>
                <field name="author" type="NX_CHAR" optional="true">
                    <doc>Author or creator of note</doc>
                </field>
                <field name="date" type="NX_DATE_TIME" optional="true">
                    <doc>Date note created/added</doc>
                </field>
            </group>
            
            <group name="source" type="NXsource" optional="false">
                <field name="type" type="NX_CHAR" optional="false">
                    <doc>   Type of radiation source (pick one from the enumerated list and spell exactly)
                            Any of these values:
                                - ``Spallation Neutron Source``
                                - ``Pulsed Reactor Neutron Source``
                                - ``Reactor Neutron Source``
                                - ``Synchrotron X-ray Source``
                                - ``Rotating Anode X-ray``
                                - ``Fixed Tube X-ray``
                                - ``Metal Jet X-ray``
                    </doc>
                </field>
                <field name="probe" type="NX_CHAR" optional="false">
                    <doc>   Type of radiation probe (pick one from the enumerated list and spell exactly)
                            Any of these values: ``neutron`` | ``X-ray``
                    </doc>
                </field>
                <field name="energy" type="NX_FLOAT" units="NX_ENERGY" optional="true">
		            <doc>
			                Source energy. The energy should be provided in keV, but if chosen otherwise, the units must be clearly specified. For storage rings, this would be the particle beam energy.
			                For X-ray tubes, this would be the excitation voltage. In case of energy dispersive diffraction, the
		            </doc>
	            </field>
                <field name="wavelength" type="NX_FLOAT" optional="true">
                    <doc>
                        In case of monochromatic radiation, the wavelength used during the experiment. The wavelength should be provided in \ :math:`\unicode{x212B}`, but if chosen otherwise, the units must be clearly specified.
                    </doc>
                </field>
            </group>
            <group name="DETECTOR" type="NXdetector" minOccurs="1" maxOccurs="unbounded">
                <doc>Zero or more of these groups describe the detectors used in the experiment.</doc>
                <field name="description" type="NX_CHAR" optional="true">
                    <doc>name/manufacturer/model/etc. information</doc>
                </field>
                <field name="type" type="NX_CHAR">
		            <doc>
			                Description of type such as \ :sup:`3`\ He gas cylinder, \ :sup:`3`\ He PSD, scintillator, fission chamber, proportion counter, ion chamber, CCD, pixel, image plate, CMOS, …
		            </doc>
	            </field>
                <field name="distance" type="NX_NUMBER" units="NX_LENGTH" optional="true">
                    <doc>
                      This is the distance to the previous component in the
                      instrument; most often the sample. The usage depends on the
                      nature of the detector: Most often it is the distance of the
                      detector assembly. But there are irregular detectors. In this
                      case the distance must be specified for each detector pixel.
                    </doc>
                </field>
                <field name="efficiency" type="NX_FLOAT" units="NX_DIMENSIONLESS" optional="true">
                    <doc>efficiency of the detector</doc>
                        <dimensions rank="2">
                            <dim index="1" value="i" />
                            <dim index="2" value="j" />
                        </dimensions>
                </field>
                <field name="wavelength" type="NX_FLOAT" units="NX_WAVELENGTH" optional="true">
                    <doc>
                        This field can be two things:

                        1. For a pixel detector it provides the nominal wavelength
                        for which the detector has been calibrated.

                        2. For other detectors this field has to be seen together with
                        the efficiency field above.
                        For some detectors, the efficiency is wavelength dependent.
                        Thus this field provides the wavelength axis for the efficiency field.
                        In this use case, the efficiency and wavelength arrays must
                        have the same dimensionality.
                    </doc>

                    <dimensions rank="2">
                      <dim index="1" value="i" />
                      <dim index="2" value="j" />
                    </dimensions>
                </field>
                <field name="dead_time" type="NX_FLOAT" units="NX_TIME" optional="true">
                    <doc>Detector dead time</doc>
                    <dimensions rank="3">
                        <dim index="1" value="nP" />
                        <dim index="2" value="i" />
                        <dim index="3" value="j" />
                    </dimensions>
                </field>
                <field name="count_time" type="NX_NUMBER" units="NX_TIME" optional="true">
                    <doc>Elapsed actual counting time</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nP" />
                    </dimensions>
                </field>
                <field name="depends_on" type="NX_CHAR" optional="true">
                    <doc>
                        The axis on which the detector position depends may be stored
                        anywhere, but is normally stored in the *NXtransformations
                        group* within the *NXdetector group*.
                    </doc>
                </field>
                <group type="NXtransformations" minOccurs="0">
                    <doc>
                        This is the recommended location for detector goniometer
                        and other related axes.
                    </doc>
                </group>
            </group>
            <group name="beam_intensity_profile" type="NXbeam" optional="false">
                <doc>
                 Defines the dimensions of the beam profile used for probing the sample which corresponds to or can be used to determine the instrumental gauge volume.  
                 A description of the subsequent fields can be found in the folowing figure. The term "primary" in the subsequent fields refers to the beam path between the sample and the source. The term "secondary" refers to the beam path between the sample and the detector(s). 
                 
                 .. figure:: stress/Beam_profile_sketch3.jpg
                  :width: 70%
                  :alt: Examples for the beam intensity profile.

                  Some examples for the beam intensity profile. The 1D description of the beam profile on the right can equally be applied for the horizontal and vertical direction for the primary and the secondary side.

                </doc>
                <field name="beam_evaluation" type="NX_CHAR" optional="true">
                    <doc>If the beam profile was measured, the filename(s) of the measurement can be specified here. </doc>
                </field>

                <field name="primary_vertical_type" type="NX_CHAR" optional="true">
                    <doc>Defines the last device right in front of the sample used to shape the beam. This could be, for example, a :ref:`(radial) collimator &lt;NXcollimator&gt;` or a :ref:`slit &lt;NXslit&gt;`.</doc>
                </field>
                <field name="primary_vertical_source_width" type="NX_NUMBER" optional="true">
                    <doc>
                        Defines the primary beam size intensity profile on the side closer to the source in the vertical direction.
                    </doc>
                </field>
                <field name="primary_vertical_sample_width" type="NX_NUMBER" optional="true">
                    <doc>
                        Defines the primary beam size intensity profile on the side closer to the sample in the vertical direction.
                    </doc>
                </field>
                <field name="primary_vertical_distance" type="NX_NUMBER" optional="true">
                    <doc>
                        Defines the distance between the center of the gauge volume and the beam shaping device.
                    </doc>
                </field>
                <field name="primary_vertical_evaluation" type="NX_CHAR" optional="true">
                    <doc>
                        Describes how the beam intensity profile in the primary vertical direction was determined. Examples of valid entries are: ``measured``, ``theoretical``, ``estimated``, ...  
                    </doc>
                </field>

                <field name="primary_horizontal_type" type="NX_CHAR" optional="true">
                    <doc>Defines the last device right in front of the sample used to shape the beam. This could be, for example, a :ref:`(radial) collimator &lt;NXcollimator&gt;` or a :ref:`slit &lt;NXslit&gt;`.</doc>
                </field>
                <field name="primary_horizontal_source_width" type="NX_NUMBER" optional="true">
                    <doc>
                        Defines the primary beam size intensity profile on the side closer to the source in the horizontal direction.
                    </doc>
                </field>
                <field name="primary_horizontal_sample_width" type="NX_NUMBER" optional="true">
                    <doc>
                        Defines the primary beam size intensity profile on the side closer to the sample in the horizontal direction.
                    </doc>
                </field>
                <field name="primary_horizontal_distance" type="NX_NUMBER" optional="true">
                    <doc>
                        Defines the distance between the center of the gauge volume and the beam shaping device.
                    </doc>
                </field>
                <field name="primary_horizontal_evaluation" type="NX_CHAR" optional="true">
                    <doc>
                        Describes how the beam intensity profile in the primary horizontal direction was determined. Examples of valid entries are: ``measured``, ``theoretical``, ``estimated``, ...  
                    </doc>
                </field>

                <field name="secondary_horizontal_type" type="NX_CHAR" optional="true">
                    <doc>Defines the last device right in front of the sample used to shape the beam. This could be, for example, a :ref:`(radial) collimator &lt;NXcollimator&gt;` or a :ref:`slit &lt;NXslit&gt;`.</doc>
                </field>
                <field name="secondary_horizontal_detector_width" type="NX_NUMBER" optional="true">
                    <doc>
                        Defines the secondary beam size intensity profile on the side closer to the detector in the horizontal direction.
                    </doc>
                </field>
                <field name="secondary_horizontal_sample_width" type="NX_NUMBER" optional="true">
                    <doc>
                        Defines the secondary beam size intensity profile on the side closer to the sample in the horizontal direction.
                    </doc>
                </field>
                <field name="secondary_horizontal_distance" type="NX_NUMBER" optional="true">
                    <doc>
                        Defines the distance between the center of the gauge volume and the beam shaping device.
                    </doc>
                </field>
                <field name="secondary_horizontal_evaluation" type="NX_CHAR" optional="true">
                    <doc>
                        Describes how the beam intensity profile in the secondary horizontal direction was determined. Examples of valid entries are: ``measured``, ``theoretical``, ``estimated``, ...  
                    </doc>
                </field>
            </group>
        </group>

        <group name="sample_description" type="NXsample" optional="false">
            <doc>
                    This is the recommended location for describing parameters associated with the sample.
            </doc>
            <field name="name" type="NX_CHAR" optional="false">
                <doc>
                    Descriptive name of sample
                </doc>
            </field>
            <field name="chemical_formula" optional="true">
		        <doc>
			        The chemical formula specified using CIF conventions.
			        Abbreviated version of CIF standard: 

			        * Only recognized element symbols may be used.
			        * Each element symbol is followed by a 'count' number. A count of '1' may be omitted.
			        * A space or parenthesis must separate each cluster of (element symbol + count).
			        * Where a group of elements is enclosed in parentheses, the multiplier for the 
			          group must follow the closing parentheses. That is, all element and group 
			          multipliers are assumed to be printed as subscripted numbers.
			        * Unless the elements are ordered in a manner that corresponds to their chemical 
			          structure, the order of the elements within any group or moiety depends on 
			          whether or not carbon is present.
			        * If carbon is present, the order should be: 

			          - C, then H, then the other elements in alphabetical order of their symbol. 
			          - If carbon is not present, the elements are listed purely in alphabetic order of their symbol. 

			        * This is the *Hill* system used by Chemical Abstracts.
		        </doc>
	        </field>
            <field name="temperature" type="NX_FLOAT" units="NX_TEMPERATURE" optional="true">
		        <doc>Sample temperature. This could be a scanned variable</doc>
		        <dimensions rank="anyRank">
		                	<dim index="1" value="n_Temp"/><!-- could be any length -->
		        </dimensions>
	        </field>
            <field name="stress_field" type="NX_FLOAT" units="NX_ANY" optional="true">
		        <doc>Applied external stress field</doc>
		        <dimensions>
			            <dim index="1" value="n_sField"/><!-- could be any length -->
		        </dimensions>
                <attribute name="direction">
        	        <enumeration>
        		        <item value="x"/>
        		        <item value="y"/>
        		        <item value="z"/>
        	        </enumeration>
                </attribute>
	        </field>
            <group name="gauge_volume" type="NXcollection" optional="true">
                <doc> The gauge volume can be described with the following parameters:
                 .. figure:: stress/GV2.jpg
                  :width: 70%
                  :alt: Dimensions of the gauge volume.

                  Parameters describing the gauge volume.
                </doc>
                <field name="x" type="NX_FLOAT" units="NX_LENGTH" optional="true">
                    <doc>
                        Length of the first diagonal.
                    </doc>
                </field>
                <field name="y" type="NX_FLOAT" units="NX_LENGTH" optional="true">
                    <doc>
                        Length of the second diagonal normal to :ref:`a &lt;/NXstress/ENTRY/sample_description/gauge_volume/x-field&gt;`.
                    </doc>
                </field>
                <field name="z" type="NX_FLOAT" units="NX_LENGTH" optional="true">
                    <doc>
                        Height of the gauge volume.
                    </doc>
                </field>            
                <field name="depends_on" type="NX_CHAR" optional="true">
                    <doc>
                    The axis on which the sample position depends may be stored
                    anywhere, but is normally stored in the NXtransformations
                    group within the NXsample group.
                    </doc>
                </field>
            </group>
            <group type="NXtransformations" minOccurs="0">
                <doc>
                This is the recommended location for sample goniometer
                and other related axes.
                </doc>
            </group>
        </group>

        <group name="fit" type="NXprocess" minOccurs="1" maxOccurs="unbounded">
            <doc>
                Zero or more groups to describe the data processing steps
                to obtain the content of this application definition.
            </doc>
            <field name="raw_data_file" type="NX_CHAR" optional="false">
                <doc>
                    The raw data file name(s) used during the data reduction process. This can be a list.
                </doc>
            </field>
            <field name="date" type="NX_DATE_TIME" optional="false">
                <doc>
                    Date when the raw data was reduced and the data in the *NXstress* file format generated.
                </doc>
            </field>
            <field name="program" type="NX_CHAR" optional="false">
                <doc>
                    Software package used to perform data reduction including the version number or release date.
                </doc>
            </field>
            <field name="integration_type" type="NX_CHAR" optional="true">
                <doc>
                    Describes how the data was integrated.
                </doc>
            </field>
            <field name="bins" type="NX_CHAR" optional="true">
                <doc>
                    Describes the type of binning used during data reduction.
                </doc>
            </field>
            <field name="fit_type" type="NX_CHAR" optional="true">
                <doc>
                    Describes how the fitting of the peaks was done. For example, single peak fit, multiple peak fit, Pawley refinement, Rietveld refinement, …
                </doc>
            </field>
            <field name="fit_range" type="NX_CHAR" optional="true">
                <doc>
                    Describes the data range used for peak fitting.
                </doc>
            </field>
            <field name="goodness_of_fit" type="NX_CHAR" optional="true">
                <doc>
                    Type and value describing the goodness of fit. For example, Rw 0.23.
                </doc>
            </field>
            <field name="normalization" type="NX_CHAR" optional="true">
                <doc>
                    Describes whether the data was normalized and if so , how. Examples of valid entries are: ``None``, ``time``, ``primary monitor``, ``detector``, …
                </doc>
            </field>
            <group name="data_reduction_responsible" type="NXuser" optional="true">
                <doc>Information about the person who performed the data reduction.</doc>
                    <field name="name" type="NX_CHAR" optional="true">
                    </field>
                    <field name="role" type="NX_CHAR" optional="true">
                        <doc>Role of user responsible for this entry. Suggested roles are, for example, ``local contact``, ``beamline_scientist``, ``post_doc``,…</doc>
                    </field>        
            </group>
            <group name="description" type="NXnote">
                <doc>
                    The note will contain information about how the data was processed
                    or anything about the data provenance. 
                    The contents of the note can be anything that the processing code 
                    can understand, or a simple text.
            
                    The name will be numbered to allow for ordering of steps.
                 </doc>
            </group>
            <group name="peak_parameters" type="NXdata" optional="false">
                <doc>
                    This group contains all diffraction peak fit parameters. 
                    This information is not required for stress and strain calculations.
                    Note that as in any *NXdata* group, each field can have uncertainties
                    associated to them (e.g. *center_errors* would be the uncertainties
                    on the peak center).
                </doc>
                <field name="title" type="NX_CHAR" optional="false">
                    <doc>Diffraction peak profile.</doc>
                    <enumeration>
                        <item value="gaussian" />
                        <item value="lorentzian" />
                        <item value="voigt" />
                        <item value="pseudo-voigt" />
                        <item value="split pseudo-voigt" />
                        <item value="pearson VII" />
                    </enumeration>
                </field>
                <field name="area" type="NX_NUMBER" units="NX_ANY" optional="true">
                    <doc>Diffraction peak area (not including the background) in *yUnit* units.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                    <attribute name="units" type="NX_CHAR">
                        <doc>Specify the *yUnit* units</doc>
                    </attribute>
                </field>

                <field name="height" type="NX_NUMBER" optional="true" units="NX_ANY">
                    <doc>Diffraction peak height (not including the background) in *yUnit* units.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                    <attribute name="units" type="NX_CHAR">
                        <doc>Specify the *yUnit* units</doc>
                    </attribute>
                </field>
                <field name="fwhm" type="NX_NUMBER" units="NX_ANY" optional="true">
                    <doc>Diffraction peak full width at half maximum in *xUnit* units.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                    <attribute name="units" type="NX_CHAR">
                        <doc>Specify the *xUnit* units</doc>
                    </attribute>
                </field>

                <field name="fwhm_left" type="NX_NUMBER" optional="true" units="NX_ANY">
                    <doc>Left-side FWHM for split profiles in *xUnit* units.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                    <attribute name="units" type="NX_CHAR">
                        <doc>Specify the *xUnit* units</doc>
                    </attribute>
                </field>
                <field name="fwhm_right" type="NX_NUMBER" optional="true" units="NX_ANY">
                    <doc>Right-side FWHM for split profiles in *xUnit* units.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                    <attribute name="units" type="NX_CHAR">
                        <doc>Specify the *xUnit* units</doc>
                    </attribute>
                </field>
                <field name="form_factor" type="NX_NUMBER" optional="true" units="NX_DIMENSIONLESS">
                    <doc>
                    - Voigt or Pseudo-Voigt: Lorentzian fraction
                    - Pearson VII: decay parameter
                    - Other profiles: not applicable
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                </field>
                <field name="form_errors" type="NX_NUMBER" optional="true" units="NX_DIMENSIONLESS">
                    <doc>
                        Error value(s) asscociated with the form_factor.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                </field>
                <field name="azimuth" type="NX_NUMBER" optional="true" units="NX_ANGLE">
                    <doc>
                        Angle that define the position of the integrated sector in the diffraction cone
                        for angular-dispersive diffraction or the position of the detector for energy-dispersive
                        diffraction.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                </field>
            </group>
            <group name="background_parameters" type="NXdata" optional="false">
                <doc>
                    This group contains all background fit parameters. 
                    This information is not required for stress and strain caluclations.
                </doc>
                <field name="title" type="NX_CHAR" optional="false">
                    <doc>
                        Diffraction background profile. Required when background parameter fields are present.
                        Some example values with equations are shown below: 

                            - ``manual`` : No equations nor variables needed to describe this background.
                            - ``linear`` : \ :math:`\small background= A0 + A1 \cdot x`
                            - ``5-degree polynomial`` : \ :math:`\small background= A0 + A1 \cdot x + A2 \cdot \mathrm{x}^{2} + A3 \cdot \mathrm{x}^{3} + A4 \cdot \mathrm{x}^{4} + A5 \cdot \mathrm{x}^{5}`
                            - ``shape function plus polynomial`` : A shape function is not a mathematical function, it contains a manual background obtained from a fit and a polynomial part. This allows to adapt and modify the fit for subsequent measurements in the same measurement campaign. The function describing it is the following: \ :math:`\small background= as + b \cdot SHAPE(x-o)` Where SHAPE is the name of the variable used to describe the background value at the position x. x can be e.g. the scattering angle \ :math:`2\theta` in degrees. 
                    </doc>
                </field>
                <field name="A" nameType="any" type="NX_NUMBER" units="NX_DIMENSIONLESS" minOccurs="0" maxOccurs="unbounded">
                    <doc>Background parameter(s). For example a second-degree polynomial will have fields ``A0``, ``A1`` and ``A2``.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                </field>
                <field name="as" nameType="any" type="NX_NUMBER" units="NX_DIMENSIONLESS" minOccurs="0" maxOccurs="unbounded">
                    <doc>Background parameter *constant* for SHAPE function.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                </field>
                <field name="as_errors" nameType="any" type="NX_NUMBER" units="NX_DIMENSIONLESS" minOccurs="0" maxOccurs="unbounded">
                    <doc>Error associated with background parameter *constant* for SHAPE function.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                </field>
                <field name="b" nameType="any" type="NX_NUMBER" units="NX_DIMENSIONLESS" minOccurs="0" maxOccurs="unbounded">
                    <doc>Background parameter *amplitude* for SHAPE function.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                </field>
                <field name="b_errors" nameType="any" type="NX_NUMBER" units="NX_DIMENSIONLESS" minOccurs="0" maxOccurs="unbounded">
                    <doc>Error associated with background parameter *amplitude* for SHAPE function.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                </field>
                <field name="o" nameType="any" type="NX_NUMBER" units="NX_DIMENSIONLESS" minOccurs="0" maxOccurs="unbounded">
                    <doc>Background parameter *offset* for SHAPE function.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                </field>
                <field name="o_errors" nameType="any" type="NX_NUMBER" units="NX_DIMENSIONLESS" minOccurs="0" maxOccurs="unbounded">
                    <doc>Error associated with background parameter *offset* for SHAPE function.</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                </field>
                <field name="background_area" type="NX_NUMBER" units="NX_ANY" optional="true">
                    <doc>The background area in *yUnit* units, integrated over a confidence interval around the center (*0.95* by default).</doc>
                    <dimensions rank="1">
                        <dim index="1" value="nPeaks" />
                    </dimensions>
                    <attribute name="units" type="NX_CHAR">
                        <doc>Specify the *yUnit* units</doc>
                    </attribute>
                </field>
                <field name="background_area_interval" type="NX_DIMENSIONLESS" optional="true">
                    <doc>
                        Confidence interval from which the background counts are integrated.
                        For example *0.95* means that the background is integrated over the range in
                        which the integrated peak area is 95% of the total peak area.
                    </doc>
                </field>
            </group>

            <group name="DIFFRACTOGRAM" type="NXdata" optional="false">
                <doc>
                    Diffractogram with fit results in :ref:`peak_parameters &lt;/NXstress/ENTRY/fit/peak_parameters-group&gt;`
                    and :ref:`background_parameters &lt;/NXstress/ENTRY/fit/background_parameters-group&gt;`.
                    This information is not required for stress and strain caluclations.
                </doc>
                <attribute name="axes">
                    <doc>List of the one to two axes field name(s) to be used by default. The axes are further described in the fields DAXIS and XAXIS.</doc>
                </attribute>

                <field name="DAXIS" nameType="any" minOccurs="0" maxOccurs="unbounded">
                    <doc>
                        One or more fields that contain the values for the **nD** dimension.
                        For example the azimuthal positions of different energy-dispersive detectors
                        or the average azimuth of different azimuthal sections on an area detector.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="nD" />
                    </dimensions>
                </field>

                <field name="XAXIS" nameType="any" type="NX_NUMBER" units="NX_ANY" minOccurs="1" maxOccurs="unbounded">
                    <doc>
                        One or more fields that contain the values for the **nX** dimension in *xUnit* units.
                        For example: MCA channels, scattering angle \ :math:`2\theta` in degrees,
                        scattering vector length q in \ :math:`\mathrm{nm}^{-1}`, ...
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="nX" />
                    </dimensions>
                    <attribute name="units" type="NX_CHAR">
                        <doc>Specify the *xUnit* units</doc>
                    </attribute>
                </field>

                <attribute name="signal">
                    <doc>Default field name to be plotted.</doc>
                    <enumeration>
                        <item value="diffractogram" />
                    </enumeration>
                </attribute>

                <attribute name="auxiliary_signals">
                    <doc>List of additional field names to be plotted. This could be e.g. fit, background, residuals, …</doc>
                </attribute>

                <field name="diffractogram" type="NX_NUMBER" units="NX_ANY">
                    <doc>Diffractogram counts in *yUnit* units (default signal)</doc>
                    <dimensions rank="2">
                        <dim index="1" value="nD" />
                        <dim index="2" value="nX" />
                    </dimensions>
                    <attribute name="interpretation" type="NX_CHAR">
                        <enumeration>
                            <item value="spectrum" />
                        </enumeration>
                    </attribute>
                    <attribute name="units" type="NX_CHAR">
                        <doc>Specify the *yUnit* units</doc>
                    </attribute>
                </field>

                <field name="diffractogram_errors" type="NX_NUMBER" units="NX_ANY">
                    <doc>Diffractogram counts error in *yUnit* units (default signal)</doc>
                    <dimensions rank="2">
                        <dim index="1" value="nD" />
                        <dim index="2" value="nX" />
                    </dimensions>
                    <attribute name="interpretation" type="NX_CHAR">
                        <enumeration>
                            <item value="spectrum" />
                        </enumeration>
                    </attribute>
                    <attribute name="units" type="NX_CHAR">
                        <doc>Specify the *yUnit* units</doc>
                    </attribute>
                </field>

                <field name="fit" type="NX_NUMBER">
                    <doc>Diffractogram fit counts (auxiliary signal).</doc>
                    <dimensions rank="2">
                        <dim index="1" value="nD" />
                        <dim index="2" value="nX" />
                    </dimensions>
                    <attribute name="interpretation" type="NX_CHAR">
                        <enumeration>
                            <item value="spectrum" />
                        </enumeration>
                    </attribute>
                </field>

                <field name="fit_errors" type="NX_NUMBER">
                    <doc>Diffractogram fit counts error (auxiliary signal).</doc>
                    <dimensions rank="2">
                        <dim index="1" value="nD" />
                        <dim index="2" value="nX" />
                    </dimensions>
                </field>

                <field name="background" type="NX_NUMBER" minOccurs="0">
                    <doc>In case the diffraction background was manually determined. Diffractogram background counts (auxiliary signal).</doc>
                    <dimensions rank="2">
                        <dim index="1" value="nD" />
                        <dim index="2" value="nX" />
                    </dimensions>
                    <attribute name="interpretation" type="NX_CHAR">
                        <enumeration>
                            <item value="spectrum" />
                        </enumeration>
                    </attribute>
                </field>
                <field name="residuals" type="NX_NUMBER" minOccurs="0">
                    <doc>Difference between diffractogram and fit (auxiliary signal).</doc>
                    <dimensions rank="2">
                        <dim index="1" value="nD" />
                        <dim index="2" value="nX" />
                    </dimensions>
                    <attribute name="interpretation" type="NX_CHAR">
                        <enumeration>
                            <item value="spectrum" />
                        </enumeration>
                    </attribute>
                </field>
            </group>
        </group>

        <group name="notes" type="NXnote" optional="true">
            <doc>
                User description of the data acquisitions.
                A description of data analysis goes in the
                *fig_log group*.
            </doc>
        </group>

        <group name="peaks" type="NXreflections" optional="false">
            <doc>
                This group contains all diffraction peak parameters that could be needed for stress and strain calculations. 
                These parameters are derived from :ref:`peak_parameters &lt;/NXstress/ENTRY/fit/peak_parameters-group&gt;` and additional metadata.
            </doc>
            <field name="h" type="NX_INT" units="NX_UNITLESS">
                <doc>First Miller index.</doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            <field name="k" type="NX_INT" units="NX_UNITLESS">
                <doc>Second Miller index.</doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            <field name="l" type="NX_INT" units="NX_UNITLESS">
                <doc>Third Miller index.</doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            <field name="lattice" type="NX_CHAR" optional="true">
                <doc>Crystal lattice systems (*cubic*, *hexagonal*, ...)</doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            <field name="space_group" type="NX_CHAR" optional="true">
                <doc>Crystallographic space group :math:`(Fm\bar{3}m, Im\bar{3}m, ...)`</doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            <field name="phase_name" type="NX_CHAR" optional="false">
                <doc>Name of the crystallographic phase (hematite, goethite, a-Al\ :sub:`2`\ O\ :sub:`3`\ , ...).</doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            <field name="qx" type="NX_NUMBER" units="NX_DIMENSIONLESS">
                <doc>
                    First component of the *normalized* scattering vector *Q* in the sample reference frame.
                    The sample reference frame is defined by the :ref:`sample transformations &lt;/NXstress/ENTRY/sample_description/TRANSFORMATIONS-group&gt;`.
                </doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            <field name="qy" type="NX_NUMBER" units="NX_DIMENSIONLESS">
                <doc>
                    Second component of the *normalized* scattering vector *Q* in the sample reference frame.
                    The sample reference frame is defined by the :ref:`sample transformations &lt;/NXstress/ENTRY/sample_description/TRANSFORMATIONS-group&gt;`.
                </doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            <field name="qz" type="NX_NUMBER" units="NX_DIMENSIONLESS">
                <doc>
                    Third component of the *normalized* scattering vector *Q* in the sample reference frame.
                    The sample reference frame is defined by the :ref:`sample transformations &lt;/NXstress/ENTRY/sample_description/TRANSFORMATIONS-group&gt;`.
                </doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            <field name="center" type="NX_NUMBER" units="NX_ANY" optional="false">
                <doc>Diffraction peak position in *cUnit* units.</doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
                <attribute name="units" type="NX_CHAR">
                    <doc>Specify the *cUnit* units (see :ref:`center_type &lt;/NXstress/ENTRY/peaks/center_type-field&gt;`)</doc>
                    <enumeration>
                        <item value="degrees">
                            <doc>two-theta</doc>
                        </item>
                        <item value="keV">
                            <doc>energy</doc>
                        </item>
                        <item value="1/angstrom">
                            <doc>momentum-transfer</doc>
                        </item>
                        <item value="angstrom">
                            <doc>d-spacing</doc>
                        </item>
                        <item value="microseconds">
                            <doc>time-of-flight</doc>
                        </item>
                        <item value="''">
                            <doc>channel (dimensionless)</doc>
                        </item>
                    </enumeration>
                </attribute>
            </field>
            <field name="center_errors" type="NX_NUMBER" units="NX_ANY" optional="false">
                <doc>Uncentrainties on :ref:`center &lt;/NXstress/ENTRY/peaks/center-field&gt;` in *cUnit* units.</doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
                <attribute name="units" type="NX_CHAR">
                    <doc>Specify the *cUnit* units (see :ref:`center_type &lt;/NXstress/ENTRY/peaks/center_type-field&gt;`)</doc>
                    <enumeration>
                        <item value="degrees">
                            <doc>two-theta</doc>
                        </item>
                        <item value="keV">
                            <doc>energy</doc>
                        </item>
                        <item value="1/angstrom">
                            <doc>momentum-transfer</doc>
                        </item>
                        <item value="angstrom">
                            <doc>d-spacing</doc>
                        </item>
                        <item value="microseconds">
                            <doc>time-of-flight</doc>
                        </item>
                        <item value="''">
                            <doc>channel (dimensionless)</doc>
                        </item>
                    </enumeration>
                </attribute>
            </field>
            <field name="center_type" type="NX_CHAR" optional="false">
                <doc>
                        The space in which :ref:`center &lt;/NXstress/ENTRY/peaks/center-field&gt;` is defined.
                        It defines the *cUnit* as follows

                            - if *center_type="two-theta"* then *cUnit* must have the angle unit *degrees*
                            - if *center_type="energy"* then *cUnit* must have the energy unit *keV*
                            - if *center_type="momentum-transfer"* then *cUnit* must have the energy unit \ :math:`\unicode{x212B}^{-1}`
                            - if *center_type="d-spacing"* then *cUnit* must have the energy unit \ :math:`\unicode{x212B}`
                            - if *center_type="channel"* then *cUnit* must be *dimensioness*
                            - if *center_type="time-of-flight"* then *cUnit* must have the time-of-flight unit \ :math:`\mu\mathrm{s}`
                </doc>
                <enumeration>
                    <item value="two-theta" />
                    <item value="energy" />
                    <item value="momentum-transfer" />
                    <item value="d-spacing" />
                    <item value="channel" />
                    <item value="time-of-flight" />
                </enumeration>
            </field>
            <field name="sx" type="NX_NUMBER" units="NX_LENGTH" optional="false">
                <doc>
                    First component of the sample position in the sample reference frame.
                    The sample reference frame is defined by the :ref:`sample transformations &lt;/NXstress/ENTRY/sample_description/TRANSFORMATIONS-group&gt;`.
                </doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            
            <field name="sy" type="NX_NUMBER" units="NX_LENGTH" optional="false">
                <doc>
                    First component of the sample position in the sample reference frame.
                    The sample reference frame is defined by the :ref:`sample transformations &lt;/NXstress/ENTRY/sample_description/TRANSFORMATIONS-group&gt;`.
                </doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
            <field name="sz" type="NX_NUMBER" units="NX_LENGTH" optional="false">
                <doc>
                    First component of the sample position in the sample reference frame.
                    The sample reference frame is defined by the :ref:`sample transformations &lt;/NXstress/ENTRY/sample_description/TRANSFORMATIONS-group&gt;`.
                </doc>
                <dimensions rank="1">
                    <dim index="1" value="nPeaks" />
                </dimensions>
            </field>
        </group>

    </group>
</definition>