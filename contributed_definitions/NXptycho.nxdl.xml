<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl" ?>
<!-- 
  # NeXus - Neutron and X-ray Common Data Format
  # 
  # Copyright (C) 2014-2015 NeXus International Advisory Committee (NIAC)
  # 
  # This library is free software; you can redistribute it and/or
  # modify it under the terms of the GNU Lesser General Public
  # License as published by the Free Software Foundation; either
  # version 3 of the License, or (at your option) any later version. 
  # 
  # This library is distributed in the hope that it will be useful,
  # but WITHOUT ANY WARRANTY; without even the implied warranty of
  # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  # Lesser General Public License for more details.
  #
  # You should have received a copy of the GNU Lesser General Public
  # License along with this library; if not, write to the Free Software
  # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  #
  # For further information, see http://www.nexusformat.org 
-->
<definition name="NXptycho" extends="NXobject" type="group"
    category="application"
    xmlns="http://definition.nexusformat.org/nxdl/@NXDL_RELEASE@"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://definition.nexusformat.org/nxdl/@NXDL_RELEASE@ ../nxdl.xsd"
    version="1.1"
    >
    <symbols>
        <doc>These symbols will be used below to coordinate the shapes of the datasets.</doc>
        <symbol name="npts_x">
        	<doc>The number of points in the x direction</doc></symbol>
        
        <symbol name="npts_y">
        	<doc>Number of points in the y direction. </doc></symbol>
        <symbol name="npts_theta">
        	<doc>Number of rotation steps</doc></symbol>
        <symbol name="frame_size_x">
        	<doc>Number of detector pixels in x</doc></symbol>
        <symbol name="frame_size_y">
        	<doc>Number of detector pixels in y</doc>
        </symbol></symbols>
    <doc>
          Application definition for a ptychography experiment, which will contain the values 
          for the coherence (NXsource), the energy (NXmonochromator), the focussing optics 
          (NXfresnel_zone_plate), and their distance relative to the sample. The detector info
          (flatfield, mask, detector distance etc..) and the data. THe sample positioners are   
          NXpositioners.
    </doc>
    <group type="NXentry" name="entry">
    	<field name="title" minOccurs=0 maxOccurs=1></field>
    	<field name="start_time" type="NX_DATE_TIME" minOccurs=0 maxOccurs=1></field>
    	<field name="end_time" type="NX_DATE_TIME" minOccurs=0 maxOccurs=1></field>
    	<field name="definition">
    		<doc>Official NeXus NXDL schema to which this file conforms</doc>
    		<enumeration>
    			<item value="NXptycho"></item>
    		</enumeration></field>
    	<group type="NXinstrument" name="instrument">
    		<group type="NXsource" minOccurs=0 maxOccurs=1
    			name="coherence">
    			<field name="sigma_x" type="NX_FLOAT" minOccurs=0 maxOccurs=1></field>
    			<field name="sigma_y" type="NX_FLOAT" minOccurs=0 maxOccurs=1"></field>
    		</group>
    		<group type="NXmonochromator" name="Monochromator">
    			<field name="energy" type="NX_FLOAT" minOccurs=1 maxOccurs=1><!--We absolutely must have this information!--></field>
    			<field name="energy_error" type="NX_FLOAT" minOccurs=0 maxOccurs=1></field>
    		</group>
    		<group type="NXfresnel_zone_plate" name="fresnel_zone_plate">
    			<field name="outer_diameter" type="NX_FLOAT" minOccurs=0 maxOccurs=1></field>
    			<field name="outermost_zone_width" type="NX_FLOAT" minOccurs=0 maxOccurs=1></field>
    			<field name="distance_to_sample" type="NX_FLOAT" minOccurs=0 maxOccurs=1><!--This is new and not in the schema!-->
    			</field>
    		</group>
    		<group type="NXdetector" name="detector">
    			<field name="data" type="NX_INT" signal=1 minOccurs=1 maxOccurs=1>
    				<dimensions rank="4">
    					<dim index="1" value="npts_x" />
    					<dim index="2" value="npts_x" />
    					<dim index="3" value="frame_size_x"/>
    					<dim index="4" value="frame_size_y"/>
    					</dimensions>
    			</field>
    			<field name="x_pixel_size" type="NX_FLOAT" units="NX_LENGTH" minOccurs="1" maxOccurs=1></field><field name="y_pixel_size" type="NX_FLOAT" units="NX_LENGTH" minOccurs="1" maxOccurs="1"></field>
    			<field name="distance" type="NX_FLOAT" units="NX_LENGTH" minOccurs=1 maxOccurs=1><!--We must have this!--><doc>The distance between the detector and the sample</doc></field>
    			<field name="flatfield" type="NX_FLOAT" minOccurs=0 maxOccurs=1>
    				<dimensions rank="2">
    					<dim index="1" value="frame_size_x" /><dim
    						index="2" value="frame_size_y" name="sample"/>
    				</dimensions>
    			</field>
    			<field name="darkfield" type="NX_float" minOccurs=0 maxOccurs=1>
    			    <dimensions rank="2">
    					<dim index="1" value="frame_size_x" ></dim><dim
    						index="2" value="frame_size_y" />
    				</dimensions></field><!--Can be scanned as appropriate in theta,energy etc...-->
    				<field
    				name="pixel_mask" type="NX_INT" minOccurs=1 maxOccurs=1>
	<dimensions rank="2">
		<dim index="1" value="frame_size_x" />
		<dim index="2" value="frame_size_y" />
	</dimensions>
</field>
    		</group>
    		<group type="NXsample">
    			<field name="name",type="NX_CHAR"></field>
    			<field name="description",type="NX_CHAR"></field>
    			<group type="NXpositioner" name="positions" minOccurs=1 maxOccurs=1>
    				<field name="lab_x" type="NX_FLOAT">
    					<dimensions rank="1">
    						<dim index="1" value="npts_x" />
    					</dimensions
    				</field>
    				<field name="lab_y" type="NX_FLOAT">
    					<dimensions rank="1">
    						<dim index="1" value="npts_y" />
    					</dimensions
    				</field>
    			</group>
    		</group>
    		<group name="reference" type="NXlog" minOccurs=0 maxOccurs=1></group>
    			<field name="ion chamber" type="NX_FLOAT">
    				<dimensions rank="2">
    					<dim index="1" value="npts_x" />
    					<dim index="2" value="npts_y" />
    				</dimensions>
    			</field>
    	</group></definition>
