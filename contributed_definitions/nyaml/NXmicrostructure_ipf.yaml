category: base
doc: |
  Base class to store an inverse pole figure (IPF) mapping (IPF map).
symbols:
  v: |
    Number of pixel along the slow direction used for the IPF color key.
  u: |
    Number of pixel along the fast direction used for the IPF color key.
  n_z: |
    Number of pixel along the slowest direction, typically labeled z or k.
  n_y: |
    Number of pixel along the slow direction, typically labeled y or j.
  n_x: |
    Number of pixel along the fast direction, typically labeled x or i.
  n_rgb: |
    Number of RGB values along the fastest direction, always three.
type: group
NXmicrostructure_ipf(NXprocess):
  depends_on(NX_CHAR):
    doc: |
      Reference to an instance of :ref:`NXcoordinate_system` in which the axes axis_z,
      axis_y, and axis_x are defined.
  color_model(NX_CHAR):
    doc: |
      The algorithm whereby orientations are colored.
    enumeration: [tsl, mtex]
  projection_direction(NX_NUMBER):
    unit: NX_UNITLESS
    doc: |
      The direction normal vector along which orientations are projected.
    dimensions:
      rank: 1
      dim: (3,)
    \@depends_on(NX_CHAR):
      doc: |
        Reference to an instance of :ref:`NXcoordinate_system` in which the projection_direction is defined.
        
        If the field depends_on is not provided but parents of the instance of this base class or its
        specializations define an instance of :ref:`NXcoordinate_system`, projection_direction
        is defined in this coordinate system.
        
        If nothing is provided, it is assumed that projection_direction is defined in the McStas coordinate system.
  input_grid(NXcg_grid):
    doc: |
      Details about the original grid, i.e. the grid for which the IPF map was computed
      when that IPF map was exported from the tech partner's file format representation.
  output_grid(NXcg_grid):
    doc: |
      Details about the grid onto which the IPF is recomputed.
      
      Rescaling the visualization of the IPF map may be needed to enable
      visualization in specific software tools like H5Web.
  interpolation(NX_CHAR):
    doc: |
      How where orientation values at positions of input_grid computed to values on output_grid.
      
      Nearest neighbour means the orientation of the closed (Euclidean distance) grid point of the input_grid was taken.
    enumeration: [nearest_neighbour]
  map(NXdata):
    doc: |
      Inverse pole figure mapping.
      
      Instances named phase0 should by definition refer to the null phase notIndexed.
      Inspect the definition of :ref:`NXphase` and its field identifier_phase
      for further details.
      
      Details about possible regridding and associated interpolation
      during the computation of the IPF map visualization can be stored
      using the input_grid, output_grid, and interpolation fields.
      
      The main purpose of this map is to offer a normalized default representation
      of the IPF map for consumption by a research data management system (RDMS).
    data(NX_NUMBER):
      unit: NX_UNITLESS
      doc: |
        Inverse pole figure color code for each map coordinate.
        
        Different types of AXISNAME dimensional scale axes are found in practice. A few examples:
        
        * No scaling, e.g. pixel position values like 0, 1, 2, 3 pixel.
          Pixels on the map can be distinguished but that map is disconnected from
          any sample surface context and eventually physical scaling
        * Scaling but no offset, e.g. calibrated pixel position 0., 0.5, 1.0, 1.5 micron.
          Pixels on the map can be compared for their distance to obtain e.g. size of features
          but the position of the map relative to the e.g. the sample surface is unclear.
          For IPF maps this is the most frequently reported situation.
        * Scaling and offset, which resolves also the absolute position of the map in
          relation to the sample surface. This is useful information for stitching multiple
          mappings together and other processing where precise and accurate
          position data are relevant e.g. for correlative materials characterization.
        
        Three types of dimensional constraints for maps are possible:
        
        * (n_x, 3), a one-dimensional map,
          typically used for coarse sampling and crystal size statistics.
        * (n_y, n_x, 3), a two-dimensional map,
          the most frequently found reported
        * (n_z, n_y, n_x, 3), a three-dimensional map,
          these are commonly generated using computational methods,
          or in cases multiple EBSD maps have been stitched/reconstructed
          into a three-dimensional map.
    
    # strictly speaking unit must not be constraint for AXISNAME no scaling
    axis_z(NX_NUMBER):
      unit: NX_LENGTH
      doc: |
        Pixel center coordinate calibrated for step size along the z axis of the map.
      dimensions:
        rank: 1
        dim: (n_z,)
    axis_y(NX_NUMBER):
      unit: NX_LENGTH
      doc: |
        Pixel center coordinate calibrated for step size along the y axis of the map.
      dimensions:
        rank: 1
        dim: (n_y,)
    axis_x(NX_NUMBER):
      unit: NX_LENGTH
      doc: |
        Pixel center coordinate calibrated for step size along the x axis of the map.
      dimensions:
        rank: 1
        dim: (n_x,)
  legend(NXdata):
    doc: |
      The color code which maps color to orientation in the fundamental zone.
      
      For each stereographic standard triangle (SST), i.e. a rendering of the
      fundamental zone of the crystal-symmetry-reduced orientation space
      SO3, it is possible to define a color model which assigns a color to each
      point in the fundamental zone.
      
      Different mapping models are used. These implement (slightly) different
      scaling relations. Differences exist across representations of tech partners.
      
      Differences are which base colors of the RGB color model are placed in
      which extremal position of the SST and where the white point is located.
      
      For further details see:
      
      * [G. Nolze et al.](https://doi.org/10.1107/S1600576716012942)
      * [S. Patala et al.](https://doi.org/10.1016/j.pmatsci.2012.04.002).
      
      Details are implementation-specific and not standardized yet.
    
    # Given that the SST has a complicated geometry, it can not yet be
    # visualized using tools like H5Web, which is why for now the matrix
    # of a rasterized image which is rendered by the backend tool gets
    # copied into an RGB matrix to offer a default plot.
    data(NX_NUMBER):
      unit: NX_ANY
      
      # NX_UNITLESS or NX_DIMENSIONLESS
      doc: |
        Inverse pole figure color code for each map coordinate.
      dimensions:
        rank: 3
        dim: (v, u, 3)
    axis_y(NX_NUMBER):
      unit: NX_UNITLESS
      doc: |
        Pixel along the y-axis.
      dimensions:
        rank: 1
        dim: (v,)
    axis_x(NX_NUMBER):
      unit: NX_UNITLESS
      doc: |
        Pixel along the x-axis.
      dimensions:
        rank: 1
        dim: (u,)
  
  # for further contextualization see comments in NXms_ipf.yaml
  # https://github.com/FAIRmat-NFDI/nexus_definitions/commit/26d4faa5c6950161e48f0672f3fdfd8c9bc907e2

# ++++++++++++++++++++++++++++++++++ SHA HASH ++++++++++++++++++++++++++++++++++
# 77a3f07c431a994ce35036efe626a026e4071d506fd0d999d66fcfffdd4ee133
# <?xml version="1.0" encoding="UTF-8"?>
# <?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
# <!--
# # NeXus - Neutron and X-ray Common Data Format
# #
# # Copyright (C) 2025-2025 NeXus International Advisory Committee (NIAC)
# #
# # This library is free software; you can redistribute it and/or
# # modify it under the terms of the GNU Lesser General Public
# # License as published by the Free Software Foundation; either
# # version 3 of the License, or (at your option) any later version.
# #
# # This library is distributed in the hope that it will be useful,
# # but WITHOUT ANY WARRANTY; without even the implied warranty of
# # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# # Lesser General Public License for more details.
# #
# # You should have received a copy of the GNU Lesser General Public
# # License along with this library; if not, write to the Free Software
# # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
# #
# # For further information, see http://www.nexusformat.org
# -->
# <definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" category="base" type="group" name="NXmicrostructure_ipf" extends="NXprocess" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
#     <symbols>
#         <symbol name="v">
#             <doc>
#                 Number of pixel along the slow direction used for the IPF color key.
#             </doc>
#         </symbol>
#         <symbol name="u">
#             <doc>
#                 Number of pixel along the fast direction used for the IPF color key.
#             </doc>
#         </symbol>
#         <symbol name="n_z">
#             <doc>
#                 Number of pixel along the slowest direction, typically labeled z or k.
#             </doc>
#         </symbol>
#         <symbol name="n_y">
#             <doc>
#                 Number of pixel along the slow direction, typically labeled y or j.
#             </doc>
#         </symbol>
#         <symbol name="n_x">
#             <doc>
#                 Number of pixel along the fast direction, typically labeled x or i.
#             </doc>
#         </symbol>
#         <symbol name="n_rgb">
#             <doc>
#                 Number of RGB values along the fastest direction, always three.
#             </doc>
#         </symbol>
#     </symbols>
#     <doc>
#         Base class to store an inverse pole figure (IPF) mapping (IPF map).
#     </doc>
#     <field name="depends_on" type="NX_CHAR">
#         <doc>
#             Reference to an instance of :ref:`NXcoordinate_system` in which the axes axis_z,
#             axis_y, and axis_x are defined.
#         </doc>
#     </field>
#     <field name="color_model" type="NX_CHAR">
#         <doc>
#             The algorithm whereby orientations are colored.
#         </doc>
#         <enumeration>
#             <item value="tsl"/>
#             <item value="mtex"/>
#         </enumeration>
#     </field>
#     <field name="projection_direction" type="NX_NUMBER" units="NX_UNITLESS">
#         <doc>
#             The direction normal vector along which orientations are projected.
#         </doc>
#         <dimensions rank="1">
#             <dim index="1" value="3"/>
#         </dimensions>
#         <attribute name="depends_on" type="NX_CHAR">
#             <doc>
#                 Reference to an instance of :ref:`NXcoordinate_system` in which the projection_direction is defined.
#                 
#                 If the field depends_on is not provided but parents of the instance of this base class or its
#                 specializations define an instance of :ref:`NXcoordinate_system`, projection_direction
#                 is defined in this coordinate system.
#                 
#                 If nothing is provided, it is assumed that projection_direction is defined in the McStas coordinate system.
#             </doc>
#         </attribute>
#     </field>
#     <group name="input_grid" type="NXcg_grid">
#         <doc>
#             Details about the original grid, i.e. the grid for which the IPF map was computed
#             when that IPF map was exported from the tech partner's file format representation.
#         </doc>
#     </group>
#     <group name="output_grid" type="NXcg_grid">
#         <doc>
#             Details about the grid onto which the IPF is recomputed.
#             
#             Rescaling the visualization of the IPF map may be needed to enable
#             visualization in specific software tools like H5Web.
#         </doc>
#     </group>
#     <field name="interpolation" type="NX_CHAR">
#         <doc>
#             How where orientation values at positions of input_grid computed to values on output_grid.
#             
#             Nearest neighbour means the orientation of the closed (Euclidean distance) grid point of the input_grid was taken.
#         </doc>
#         <enumeration>
#             <item value="nearest_neighbour"/>
#         </enumeration>
#     </field>
#     <group name="map" type="NXdata">
#         <doc>
#             Inverse pole figure mapping.
#             
#             Instances named phase0 should by definition refer to the null phase notIndexed.
#             Inspect the definition of :ref:`NXphase` and its field identifier_phase
#             for further details.
#             
#             Details about possible regridding and associated interpolation
#             during the computation of the IPF map visualization can be stored
#             using the input_grid, output_grid, and interpolation fields.
#             
#             The main purpose of this map is to offer a normalized default representation
#             of the IPF map for consumption by a research data management system (RDMS).
#         </doc>
#         <field name="data" type="NX_NUMBER" units="NX_UNITLESS">
#             <doc>
#                 Inverse pole figure color code for each map coordinate.
#                 
#                 Different types of AXISNAME dimensional scale axes are found in practice. A few examples:
#                 
#                 * No scaling, e.g. pixel position values like 0, 1, 2, 3 pixel.
#                   Pixels on the map can be distinguished but that map is disconnected from
#                   any sample surface context and eventually physical scaling
#                 * Scaling but no offset, e.g. calibrated pixel position 0., 0.5, 1.0, 1.5 micron.
#                   Pixels on the map can be compared for their distance to obtain e.g. size of features
#                   but the position of the map relative to the e.g. the sample surface is unclear.
#                   For IPF maps this is the most frequently reported situation.
#                 * Scaling and offset, which resolves also the absolute position of the map in
#                   relation to the sample surface. This is useful information for stitching multiple
#                   mappings together and other processing where precise and accurate
#                   position data are relevant e.g. for correlative materials characterization.
#                 
#                 Three types of dimensional constraints for maps are possible:
#                 
#                 * (n_x, 3), a one-dimensional map,
#                   typically used for coarse sampling and crystal size statistics.
#                 * (n_y, n_x, 3), a two-dimensional map,
#                   the most frequently found reported
#                 * (n_z, n_y, n_x, 3), a three-dimensional map,
#                   these are commonly generated using computational methods,
#                   or in cases multiple EBSD maps have been stitched/reconstructed
#                   into a three-dimensional map.
#             </doc>
#         </field>
#         <!--strictly speaking unit must not be constraint for AXISNAME no scaling-->
#         <field name="axis_z" type="NX_NUMBER" units="NX_LENGTH">
#             <doc>
#                 Pixel center coordinate calibrated for step size along the z axis of the map.
#             </doc>
#             <dimensions rank="1">
#                 <dim index="1" value="n_z"/>
#             </dimensions>
#         </field>
#         <field name="axis_y" type="NX_NUMBER" units="NX_LENGTH">
#             <doc>
#                 Pixel center coordinate calibrated for step size along the y axis of the map.
#             </doc>
#             <dimensions rank="1">
#                 <dim index="1" value="n_y"/>
#             </dimensions>
#         </field>
#         <field name="axis_x" type="NX_NUMBER" units="NX_LENGTH">
#             <doc>
#                 Pixel center coordinate calibrated for step size along the x axis of the map.
#             </doc>
#             <dimensions rank="1">
#                 <dim index="1" value="n_x"/>
#             </dimensions>
#         </field>
#     </group>
#     <group name="legend" type="NXdata">
#         <doc>
#             The color code which maps color to orientation in the fundamental zone.
#             
#             For each stereographic standard triangle (SST), i.e. a rendering of the
#             fundamental zone of the crystal-symmetry-reduced orientation space
#             SO3, it is possible to define a color model which assigns a color to each
#             point in the fundamental zone.
#             
#             Different mapping models are used. These implement (slightly) different
#             scaling relations. Differences exist across representations of tech partners.
#             
#             Differences are which base colors of the RGB color model are placed in
#             which extremal position of the SST and where the white point is located.
#             
#             For further details see:
#             
#             * [G. Nolze et al.](https://doi.org/10.1107/S1600576716012942)
#             * [S. Patala et al.](https://doi.org/10.1016/j.pmatsci.2012.04.002).
#             
#             Details are implementation-specific and not standardized yet.
#         </doc>
#         <!--Given that the SST has a complicated geometry, it can not yet be
# visualized using tools like H5Web, which is why for now the matrix
# of a rasterized image which is rendered by the backend tool gets
# copied into an RGB matrix to offer a default plot.-->
#         <field name="data" type="NX_NUMBER" units="NX_ANY">
#             <!--NX_UNITLESS or NX_DIMENSIONLESS-->
#             <doc>
#                 Inverse pole figure color code for each map coordinate.
#             </doc>
#             <dimensions rank="3">
#                 <dim index="1" value="v"/>
#                 <dim index="2" value="u"/>
#                 <dim index="3" value="3"/>
#             </dimensions>
#         </field>
#         <field name="axis_y" type="NX_NUMBER" units="NX_UNITLESS">
#             <doc>
#                 Pixel along the y-axis.
#             </doc>
#             <dimensions rank="1">
#                 <dim index="1" value="v"/>
#             </dimensions>
#         </field>
#         <field name="axis_x" type="NX_NUMBER" units="NX_UNITLESS">
#             <doc>
#                 Pixel along the x-axis.
#             </doc>
#             <dimensions rank="1">
#                 <dim index="1" value="u"/>
#             </dimensions>
#         </field>
#     </group>
#     <!--for further contextualization see comments in NXms_ipf.yaml
# https://github.com/FAIRmat-NFDI/nexus_definitions/commit/26d4faa5c6950161e48f0672f3fdfd8c9bc907e2-->
# </definition>
