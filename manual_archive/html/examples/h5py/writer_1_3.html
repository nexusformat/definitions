


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>h5py example writing the simplest NeXus data file &mdash; NeXus: Manual 3.2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/blockquote.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="NeXus: Manual 3.2 documentation" href="../../index.html" />
    <link rel="up" title="2.1.2. Python Examples using h5py" href="index.html" />
    <link rel="next" title="h5py example writing a simple NeXus data file with links" href="writer_2_1.html" />
    <link rel="prev" title="2.1.2. Python Examples using h5py" href="index.html" /> 
    <link rel="stylesheet" href="../../_static/blockquote.css" type="text/css" />

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="writer_2_1.html" title="h5py example writing a simple NeXus data file with links"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="2.1.2. Python Examples using h5py"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">NeXus: Manual 3.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >2. Examples of writing and reading NeXus data files</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">2.1.2. Python Examples using <code class="docutils literal"><span class="pre">h5py</span></code></a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/nexuslogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><code class="docutils literal"><span class="pre">h5py</span></code> example writing the simplest NeXus data file</a><ul>
<li><a class="reference internal" href="#downloads">downloads</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">2.1.2. Python Examples using <code class="docutils literal"><span class="pre">h5py</span></code></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="writer_2_1.html"
                        title="next chapter"><code class="docutils literal"><span class="pre">h5py</span></code> example writing a simple NeXus data file with links</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/examples/h5py/writer_1_3.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div id="google_search" style="display: none">
	<hr />
	<h3>Google search</h3>
	<form method="get" action="http://www.google.com/search">
		<table border="0" align="center" cellpadding="0">
			<tr>
				<td>
					<input type="text"   name="q" value="" />
				</td>
			</tr>
			<tr>
				<td align="center" style="font-size:75%">
					<input type="radio"  name="sitesearch" value="" />global
					<input type="radio"  name="sitesearch"
						value="download.nexusformat.org" 
						checked />NeXus manual
					<input type="submit" value="Go" />
					<br />
				</td>
			</tr>
		</table>
	</form>                                
</div>
<script type="text/javascript">$('#google_search').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="h5py-example-writing-the-simplest-nexus-data-file">
<span id="example-writer-1-3"></span><h1><code class="docutils literal"><span class="pre">h5py</span></code> example writing the simplest NeXus data file<a class="headerlink" href="#h5py-example-writing-the-simplest-nexus-data-file" title="Permalink to this headline">¶</a></h1>
<p>In this example, the 1-D scan data will be written into the simplest
possible NeXus HDF5 data file, containing only the required NeXus components.
NeXus requires at least one <a class="reference internal" href="../../classes/base_classes/NXentry.html#nxentry"><span>NXentry</span></a> group at the root level of
an HDF5 file.  The <code class="docutils literal"><span class="pre">NXentry</span></code> group contains <em>all the data and associated
information that comprise a single measurement.</em>
NeXus also requires that each <code class="docutils literal"><span class="pre">NXentry</span></code> group must contain at least
one <a class="reference internal" href="../../classes/base_classes/NXdata.html#nxdata"><span>NXdata</span></a> group.  <code class="docutils literal"><span class="pre">NXdata</span></code> is used to describe the
plottable data in the <code class="docutils literal"><span class="pre">NXentry</span></code> group.  The simplest place to store
data in a NeXus file is directly in the <code class="docutils literal"><span class="pre">NXdata</span></code> group,
as shown in the next figure.</p>
<div class="compound">
<div class="compound-last figure" id="id3">
<span id="fig-simple-example-h5py"></span><a class="reference internal image-reference" href="../../_images/ex_writer_1_3.png"><img alt="fig.simple-example-h5py" src="../../_images/ex_writer_1_3.png" style="width: 50%;" /></a>
<p class="caption"><span class="caption-text">Simple Example</span></p>
</div>
</div>
<p>In the <a class="reference internal" href="#fig-simple-example-h5py"><span>above figure</span></a>,
the data file (<code class="docutils literal"><span class="pre">writer_1_3_h5py.hdf5</span></code>) contains
a hierarchy of items, starting with an <code class="docutils literal"><span class="pre">NXentry</span></code> named <code class="docutils literal"><span class="pre">entry</span></code>.
(The full HDF5 path reference, <code class="docutils literal"><span class="pre">/entry</span></code> in this case, is shown to the right of each
component in the data structure.)  The next <code class="docutils literal"><span class="pre">h5py</span></code> code
example will show how to build an HDF5 data file with this structure.
Starting with the numerical data described above,
the only information
written to the file is the <em>absolute</em> minimum information NeXus requires.
In this example, you can see how the HDF5 file is created, how
<a class="reference internal" href="../../design.html#design-groups"><span>Groups</span></a> and datasets (<a class="reference internal" href="../../design.html#design-fields"><span>Fields</span></a>)
are created, and how <a class="reference internal" href="../../design.html#design-attributes"><span>Attributes</span></a> are assigned.
Note particularly the <code class="docutils literal"><span class="pre">NX_class</span></code> attribute on each HDF5 group that
describes which of the NeXus <a class="reference internal" href="../../classes/base_classes/index.html#base-class-definitions"><span>Base Class Definitions</span></a> is being used.
When the next Python program (<code class="docutils literal"><span class="pre">writer_1_3_h5py.py</span></code>) is run from the
command line (and there are no problems), the <code class="docutils literal"><span class="pre">writer_1_3_h5py.hdf5</span></code>
file is generated.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Writes the simplest NeXus HDF5 file using h5py </span>

<span class="sd">Uses method accepted at 2014NIAC</span>
<span class="sd">according to the example from Figure 1.3 </span>
<span class="sd">in the Introduction chapter</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="nb">buffer</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;input.dat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">tthData</span> <span class="o">=</span> <span class="nb">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                             <span class="c"># float[]</span>
<span class="n">countsData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;int32&#39;</span><span class="p">)</span>   <span class="c"># int[]</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&#39;writer_1_3.hdf5&#39;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>  <span class="c"># create the HDF5 NeXus file</span>
<span class="c"># since this is a simple example, no attributes are used at this point</span>

<span class="n">nxentry</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s">&#39;Scan&#39;</span><span class="p">)</span>
<span class="n">nxentry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NXentry&#39;</span>

<span class="n">nxdata</span> <span class="o">=</span> <span class="n">nxentry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;NXdata&#39;</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;signal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;counts&quot;</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;two_theta&quot;</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;two_theta_indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,]</span>

<span class="n">tth</span> <span class="o">=</span> <span class="n">nxdata</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;two_theta&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">tthData</span><span class="p">)</span>
<span class="n">tth</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;degrees&quot;</span>

<span class="n">counts</span> <span class="o">=</span> <span class="n">nxdata</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;counts&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">countsData</span><span class="p">)</span>
<span class="n">counts</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;counts&quot;</span>

<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>   <span class="c"># be CERTAIN to close the file</span>
</pre></div>
</td></tr></table></div>
<p>One of the tools provided with the HDF5 support libraries is
the <code class="docutils literal"><span class="pre">h5dump</span></code> command, a command-line tool to print out the
contents of an HDF5 data file.  With no better tool in place (the
output is verbose), this is a good tool to investigate what has been
written to the HDF5 file.  View this output from the command line
using <code class="docutils literal"><span class="pre">h5dump</span> <span class="pre">writer_1_3.hdf5</span></code>.  Compare the data contents with
the numbers shown above.  Note that the various HDF5 data types have all been
decided by the <code class="docutils literal"><span class="pre">h5py</span></code> support package.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The only difference between this file and one written using the NAPI
is that the NAPI file will have some additional, optional attributes set at the root
level of the file that tells the original file name, time it was written, and some version information
about the software involved.</p>
</div>
<p>Since the output of <code class="docutils literal"><span class="pre">h5dump</span></code> is verbose (see the <em>Downloads</em> section below),
the <em>h5toText</em> tool <a class="footnote-reference" href="#id2" id="id1">[1]</a> was used to
print out the structure of HDF5 data files.  This tool provides a simplified view
of the NeXus file.  Here is the output:</p>
<div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre>writer_1_3.hdf5 : NeXus data file
  Scan:NXentry
    @NX_class = NXentry
    data:NXdata
      @NX_class = NXdata
      @signal = counts
      @axes = two_theta
      @two_theta_indices = [0]
      counts:NX_INT32[31] = [1037, 1318, 1704, &#39;...&#39;, 1321]
        @units = counts
      two_theta:NX_FLOAT64[31] = [17.926079999999999, 17.925909999999998, 17.925750000000001, &#39;...&#39;, 17.92108]
        @units = degrees
</pre></div>
</td></tr></table></div>
<p>As the data files in these examples become more complex, you will appreciate
the information density provided by <em>h5toText</em>.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><em>h5toText</em> : <a class="reference external" href="http://spec2nexus.readthedocs.org/en/latest/h5toText.html">http://spec2nexus.readthedocs.org/en/latest/h5toText.html</a></td></tr>
</tbody>
</table>
<div class="section" id="downloads">
<h2>downloads<a class="headerlink" href="#downloads" title="Permalink to this headline">¶</a></h2>
<p>The Python code and files related to this section may be downloaded from the following table.</p>
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">file</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference download internal" href="../../_downloads/writer_1_3.py"><code class="xref download docutils literal"><span class="pre">writer_1_3.py</span></code></a></td>
<td>python code to write example <em>writer_1_3</em></td>
</tr>
<tr class="row-odd"><td><a class="reference download internal" href="../../_downloads/writer_1_3.hdf5"><code class="xref download docutils literal"><span class="pre">writer_1_3.hdf5</span></code></a></td>
<td>NeXus file written by this code</td>
</tr>
<tr class="row-even"><td><a class="reference download internal" href="../../_downloads/writer_1_3_h5dump.txt"><code class="xref download docutils literal"><span class="pre">writer_1_3_h5dump.txt</span></code></a></td>
<td><em>h5dump</em> analysis of the NeXus file</td>
</tr>
<tr class="row-odd"><td><a class="reference download internal" href="../../_downloads/writer_1_3_structure.txt"><code class="xref download docutils literal"><span class="pre">writer_1_3_structure.txt</span></code></a></td>
<td><em>h5toText</em> analysis of the NeXus file</td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="writer_2_1.html" title="h5py example writing a simple NeXus data file with links"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="2.1.2. Python Examples using h5py"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">NeXus: Manual 3.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >2. Examples of writing and reading NeXus data files</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >2.1.2. Python Examples using <code class="docutils literal"><span class="pre">h5py</span></code></a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; <a href="../../copyright.html">Copyright</a> 1996-2016, http://nexusformat.org.
      Last updated on 2016-11-14 11:50:37 CET.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>