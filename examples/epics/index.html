


<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2.3.2. EPICS Area Detector Examples &#8212; nexus v2026.01 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxdoc.css?v=34905f61" />
    <link rel="stylesheet" type="text/css" href="../../_static/details_summary_hide.css?v=30df4bca" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../_static/bolditalic.css?v=504f8cd9" />
    <link rel="stylesheet" href="../../_static/blockquote.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/rubric.css" type="text/css" />
    <script src="../../_static/documentation_options.js?v=167d9c14"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="3. NeXus: Reference Documentation" href="../../ref_doc.html" />
    <link rel="prev" title="2.3.1. Viewing 2-D Data from LRMECS" href="../lrmecs/index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../ref_doc.html" title="3. NeXus: Reference Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../lrmecs/index.html" title="2.3.1. Viewing 2-D Data from LRMECS"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">nexus v2026.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U"><span class="section-number">2. </span>Examples of writing and reading NeXus data files</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">2.3.2. </span>EPICS Area Detector Examples</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="epics-area-detector-examples">
<span id="example-epics"></span><span id="index-0"></span><h1><span class="section-number">2.3.2. </span>EPICS Area Detector Examples<a class="headerlink" href="#epics-area-detector-examples" title="Link to this heading">¶</a></h1>
<p>Two examples in this section show how to write NeXus HDF5 data files
with EPICS Area Detector images.
The first shows how to configure the HDF5 File Writing Plugin
of the EPICS Area Detector software.
The second example shows how to write an EPICS Area Detector image
using Python.</p>
<section id="hdf5-file-writing-plugin">
<h2><span class="section-number">2.3.2.1. </span>HDF5 File Writing Plugin<a class="headerlink" href="#hdf5-file-writing-plugin" title="Link to this heading">¶</a></h2>
<p>This example  describes how to write a NeXus HDF5 data file
using the EPICS <a class="footnote-reference brackets" href="#id13" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> Area Detector <a class="footnote-reference brackets" href="#id14" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> HDF5 file writing plugin <a class="footnote-reference brackets" href="#id15" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.
We will use the EPICS SimDetector <a class="footnote-reference brackets" href="#id16" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a> as an example.
(PV prefix: <code class="docutils literal notranslate"><span class="pre">13SIM1:</span></code>)
Remember to replace that with the prefix for your detector’s IOC.</p>
<p>One data file will be produced for each image generated by EPICS.</p>
<p>You’ll need AreaDetector version 2.5 or higher to use this
as the procedures for using the HDF5 file writing plugin
changed with this release.</p>
<section id="configuration-files">
<h3>configuration files<a class="headerlink" href="#configuration-files" title="Link to this heading">¶</a></h3>
<p>There are two configuration files we must edit
to configure an EPICS AreaDetector
to write NeXus files using the HDF5 File Writer plugin:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>file</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">attributes.xml</span></code></p></td>
<td><p>what information to know about from EPICS and other sources</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">layout.xml</span></code></p></td>
<td><p>where to write that information in the HDF5 file</p></td>
</tr>
</tbody>
</table>
<p>Put these files into a known directory where your EPICS IOC can find them.</p>
</section>
</section>
<section id="attributes-xml">
<h2><span class="section-number">2.3.2.2. </span><code class="docutils literal notranslate"><span class="pre">attributes.xml</span></code><a class="headerlink" href="#attributes-xml" title="Link to this heading">¶</a></h2>
<p>The attributes file is easy to edit.
Any text editor will do.
A wide screen will be helpful.</p>
<p id="index-1">Each <code class="docutils literal notranslate"><span class="pre">&lt;Attribute</span> <span class="pre">/&gt;</span></code> element declares a single <strong>ndattribute</strong>
which is associated with an area detector image.  These <strong>ndattribute</strong> items can be
written to specific locations in the HDF5 file or placed by
default in a <em>default location</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The attributes file shown here has been reformatted
for display in this manual.  The <em>downloads</em> section below
provides an attributes file with the same content
using its wide formatting (one complete Attribute per line).
Either version of this file is acceptable.</p>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">&lt;?xml version=&quot;1.0&quot; standalone=&quot;no&quot; ?&gt;</span>
<span class="linenos"> 2</span><span class="cm">&lt;!-- Attributes --&gt;</span>
<span class="linenos"> 3</span><span class="nt">&lt;Attributes</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="na">xsi:noNamespaceSchemaLocation=</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="s">&quot;https://github.com/areaDetector/ADCore/blob/master/iocBoot/NDAttributes.xsd&quot;</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nt">&gt;</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="nt">&lt;Attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;AcquireTime&quot;</span><span class="w">         </span>
<span class="linenos"> 9</span><span class="w">               </span><span class="na">type=</span><span class="s">&quot;EPICS_PV&quot;</span><span class="w"> </span>
<span class="linenos">10</span><span class="w">               </span><span class="na">source=</span><span class="s">&quot;13SIM1:cam1:AcquireTime&quot;</span><span class="w">      </span>
<span class="linenos">11</span><span class="w">               </span><span class="na">dbrtype=</span><span class="s">&quot;DBR_NATIVE&quot;</span><span class="w">  </span>
<span class="linenos">12</span><span class="w">               </span><span class="na">description=</span><span class="s">&quot;Camera acquire time&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">13</span><span class="w">    </span><span class="nt">&lt;Attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ImageCounter&quot;</span><span class="w">        </span>
<span class="linenos">14</span><span class="w">               </span><span class="na">type=</span><span class="s">&quot;PARAM&quot;</span><span class="w">    </span>
<span class="linenos">15</span><span class="w">               </span><span class="na">source=</span><span class="s">&quot;ARRAY_COUNTER&quot;</span><span class="w">                </span>
<span class="linenos">16</span><span class="w">               </span><span class="na">datatype=</span><span class="s">&quot;INT&quot;</span><span class="w">        </span>
<span class="linenos">17</span><span class="w">               </span><span class="na">description=</span><span class="s">&quot;Image counter&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">&lt;Attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;calc1_val&quot;</span><span class="w">           </span>
<span class="linenos">19</span><span class="w">               </span><span class="na">type=</span><span class="s">&quot;EPICS_PV&quot;</span><span class="w"> </span>
<span class="linenos">20</span><span class="w">               </span><span class="na">source=</span><span class="s">&quot;$(P)userCalc1.VAL&quot;</span><span class="w">            </span>
<span class="linenos">21</span><span class="w">               </span><span class="na">dbrtype=</span><span class="s">&quot;DBR_NATIVE&quot;</span><span class="w"> </span>
<span class="linenos">22</span><span class="w">               </span><span class="na">description=</span><span class="s">&quot;some calculation result&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">&lt;Attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;calc2_val&quot;</span><span class="w">           </span>
<span class="linenos">24</span><span class="w">               </span><span class="na">type=</span><span class="s">&quot;EPICS_PV&quot;</span><span class="w"> </span>
<span class="linenos">25</span><span class="w">               </span><span class="na">source=</span><span class="s">&quot;$(P)userCalc2.VAL&quot;</span><span class="w">            </span>
<span class="linenos">26</span><span class="w">               </span><span class="na">dbrtype=</span><span class="s">&quot;DBR_NATIVE&quot;</span><span class="w"> </span>
<span class="linenos">27</span><span class="w">               </span><span class="na">description=</span><span class="s">&quot;another calculation result&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">28</span><span class="w">    </span><span class="nt">&lt;Attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MaxSizeX&quot;</span><span class="w">            </span>
<span class="linenos">29</span><span class="w">               </span><span class="na">type=</span><span class="s">&quot;PARAM&quot;</span><span class="w">    </span>
<span class="linenos">30</span><span class="w">               </span><span class="na">source=</span><span class="s">&quot;MAX_SIZE_X&quot;</span><span class="w">                   </span>
<span class="linenos">31</span><span class="w">               </span><span class="na">datatype=</span><span class="s">&quot;INT&quot;</span><span class="w">        </span>
<span class="linenos">32</span><span class="w">               </span><span class="na">description=</span><span class="s">&quot;Detector X size&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">33</span><span class="w">    </span><span class="nt">&lt;Attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MaxSizeY&quot;</span><span class="w">            </span>
<span class="linenos">34</span><span class="w">               </span><span class="na">type=</span><span class="s">&quot;PARAM&quot;</span><span class="w">    </span>
<span class="linenos">35</span><span class="w">               </span><span class="na">source=</span><span class="s">&quot;MAX_SIZE_Y&quot;</span><span class="w">                   </span>
<span class="linenos">36</span><span class="w">               </span><span class="na">datatype=</span><span class="s">&quot;INT&quot;</span><span class="w">        </span>
<span class="linenos">37</span><span class="w">               </span><span class="na">description=</span><span class="s">&quot;Detector Y size&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">38</span><span class="w">    </span><span class="nt">&lt;Attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CameraModel&quot;</span><span class="w">         </span>
<span class="linenos">39</span><span class="w">               </span><span class="na">type=</span><span class="s">&quot;PARAM&quot;</span><span class="w">    </span>
<span class="linenos">40</span><span class="w">               </span><span class="na">source=</span><span class="s">&quot;MODEL&quot;</span><span class="w">                        </span>
<span class="linenos">41</span><span class="w">               </span><span class="na">datatype=</span><span class="s">&quot;STRING&quot;</span><span class="w">     </span>
<span class="linenos">42</span><span class="w">               </span><span class="na">description=</span><span class="s">&quot;Camera model&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">43</span><span class="w">    </span><span class="nt">&lt;Attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CameraManufacturer&quot;</span><span class="w">  </span>
<span class="linenos">44</span><span class="w">               </span><span class="na">type=</span><span class="s">&quot;PARAM&quot;</span><span class="w">    </span>
<span class="linenos">45</span><span class="w">               </span><span class="na">source=</span><span class="s">&quot;MANUFACTURER&quot;</span><span class="w">                 </span>
<span class="linenos">46</span><span class="w">               </span><span class="na">datatype=</span><span class="s">&quot;STRING&quot;</span><span class="w">     </span>
<span class="linenos">47</span><span class="w">               </span><span class="na">description=</span><span class="s">&quot;Camera manufacturer&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">48</span><span class="nt">&lt;/Attributes&gt;</span>
</pre></div>
</div>
<p>If you want to add additional EPICS process variables (PVs)
to be written in the HDF5 file,
create additional <code class="docutils literal notranslate"><span class="pre">&lt;Attribute</span> <span class="pre">/&gt;</span></code> elements (such as the
<code class="docutils literal notranslate"><span class="pre">calc1_val</span></code>) and modify the <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">source</span></code>, and
<code class="docutils literal notranslate"><span class="pre">description</span></code> values.  Be sure to use a unique <strong>name</strong>
for each <strong>ndattribute</strong> in the attributes file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>ndattribute</strong> : item specified by
an <code class="docutils literal notranslate"><span class="pre">&lt;Attribute</span> <span class="pre">/&gt;</span></code> element in the attributes file.</p>
</div>
</section>
<section id="layout-xml">
<h2><span class="section-number">2.3.2.3. </span><code class="docutils literal notranslate"><span class="pre">layout.xml</span></code><a class="headerlink" href="#layout-xml" title="Link to this heading">¶</a></h2>
<p>You might not need to edit the layout file.
It will be fine (at least a good starting point) as it is,
even if you add PVs (a.k.a. <em>ndattribute</em>) to the attributes.xml file.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">&lt;?xml version=&quot;1.0&quot; standalone=&quot;no&quot; ?&gt;</span>
<span class="linenos"> 2</span><span class="nt">&lt;hdf5_layout&gt;</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;entry&quot;</span><span class="nt">&gt;</span><span class="w"> </span>
<span class="linenos"> 4</span><span class="w">    </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;NX_class&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;constant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;NXentry&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;instrument&quot;</span><span class="nt">&gt;</span><span class="w"> </span>
<span class="linenos"> 6</span><span class="w">      </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;NX_class&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;constant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;NXinstrument&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;detector&quot;</span><span class="nt">&gt;</span><span class="w"> </span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;NX_class&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;constant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;NXdetector&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>
<span class="linenos"> 9</span><span class="w">        </span><span class="nt">&lt;dataset</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;detector&quot;</span><span class="w"> </span><span class="na">det_default=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span><span class="w"> </span>
<span class="linenos">10</span><span class="w">          </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;NX_class&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;constant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;SDS&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>
<span class="linenos">11</span><span class="w">          </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;signal&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;constant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>
<span class="linenos">12</span><span class="w">          </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;target&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;constant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;/entry/instrument/detector/data&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>
<span class="linenos">13</span><span class="w">        </span><span class="nt">&lt;/dataset&gt;</span><span class="w"> </span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;NDAttributes&quot;</span><span class="nt">&gt;</span><span class="w"> </span>
<span class="linenos">15</span><span class="w">          </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;NX_class&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;constant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;NXcollection&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>
<span class="linenos">16</span><span class="w">          </span><span class="nt">&lt;dataset</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ColorMode&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;ndattribute&quot;</span><span class="w"> </span><span class="na">ndattribute=</span><span class="s">&quot;ColorMode&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>
<span class="linenos">17</span><span class="w">        </span><span class="nt">&lt;/group&gt;</span><span class="w">          </span><span class="cm">&lt;!-- end group NDAttribute --&gt;</span><span class="w"> </span>
<span class="linenos">18</span><span class="w">      </span><span class="nt">&lt;/group&gt;</span><span class="w">            </span><span class="cm">&lt;!-- end group detector --&gt;</span><span class="w"> </span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;NDAttributes&quot;</span><span class="w"> </span><span class="na">ndattr_default=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span><span class="w"> </span>
<span class="linenos">20</span><span class="w">        </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;NX_class&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;constant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;NXcollection&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>
<span class="linenos">21</span><span class="w">      </span><span class="nt">&lt;/group&gt;</span><span class="w">            </span><span class="cm">&lt;!-- end group NDAttribute (default) --&gt;</span><span class="w"> </span>
<span class="linenos">22</span><span class="w">      </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;performance&quot;</span><span class="nt">&gt;</span><span class="w"> </span>
<span class="linenos">23</span><span class="w">        </span><span class="nt">&lt;dataset</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;timestamp&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;ndattribute&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>
<span class="linenos">24</span><span class="w">      </span><span class="nt">&lt;/group&gt;</span><span class="w">            </span><span class="cm">&lt;!-- end group performance --&gt;</span><span class="w"> </span>
<span class="linenos">25</span><span class="w">    </span><span class="nt">&lt;/group&gt;</span><span class="w">              </span><span class="cm">&lt;!-- end group instrument --&gt;</span><span class="w"> </span>
<span class="linenos">26</span><span class="w">    </span><span class="nt">&lt;group</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;data&quot;</span><span class="nt">&gt;</span><span class="w"> </span>
<span class="linenos">27</span><span class="w">      </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;NX_class&quot;</span><span class="w"> </span><span class="na">source=</span><span class="s">&quot;constant&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;NXdata&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>
<span class="linenos">28</span><span class="w">      </span><span class="nt">&lt;hardlink</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;/entry/instrument/detector/data&quot;</span><span class="nt">/&gt;</span>
<span class="linenos">29</span><span class="w">      </span><span class="cm">&lt;!-- The &quot;target&quot; attribute in /entry/instrument/detector/data is used to </span>
<span class="linenos">30</span><span class="cm">           tell Nexus utilities that this is a hardlink --&gt;</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">&lt;/group&gt;</span><span class="w">              </span><span class="cm">&lt;!-- end group data --&gt;</span><span class="w"> </span>
<span class="linenos">32</span><span class="w">  </span><span class="nt">&lt;/group&gt;</span><span class="w">                </span><span class="cm">&lt;!-- end group entry --&gt;</span>
<span class="linenos">33</span><span class="nt">&lt;/hdf5_layout&gt;</span>
</pre></div>
</div>
<p>If you do not specify where in the file to write an <em>ndattribute</em> from the
attributes file, it will be written within the group that has
<code class="docutils literal notranslate"><span class="pre">ndattr_default=&quot;true&quot;</span></code>.  This identifies the group to the
HDF5 file writing plugin as the <em>default location</em> to store
content from the attributes file.  In the example layout file,
that <em>default location</em> is the <code class="docutils literal notranslate"><span class="pre">/entry/instrument/NDAttributes</span></code> group:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">group</span>
      <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NDAttributes&quot;</span>
      <span class="n">ndattr_default</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">attribute</span>
      <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NX_class&quot;</span>
      <span class="n">source</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span>
      <span class="n">value</span><span class="o">=</span><span class="s2">&quot;NXcollection&quot;</span>
      <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">group</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>To specify where PVs are written in the HDF5 file, you must
create <code class="docutils literal notranslate"><span class="pre">&lt;dataset</span> <span class="pre">/&gt;</span></code> (or <code class="docutils literal notranslate"><span class="pre">&lt;attribute</span> <span class="pre">/&gt;</span></code>) elements at the
appropriate place in the NeXus HDF5 file layout.  See
the NeXus manual <a class="footnote-reference brackets" href="#id17" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a> for placement advice if you are unsure.</p>
<p>You reference each <em>ndattribute</em> by its <code class="docutils literal notranslate"><span class="pre">name</span></code> value from the attributes
file and use it as the value of the <code class="docutils literal notranslate"><span class="pre">ndattribute</span></code> in the layout file.
In this example, <code class="docutils literal notranslate"><span class="pre">ndattribute=&quot;calc1_val&quot;</span></code> in the
layout file references <code class="docutils literal notranslate"><span class="pre">name=&quot;calc1_val&quot;</span></code> in the attributes file
and will be identified in the HDF5 file by the name <code class="docutils literal notranslate"><span class="pre">userCalc1</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">dataset</span>
   <span class="n">name</span><span class="o">=</span><span class="s2">&quot;userCalc1&quot;</span>
   <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ndattribute&quot;</span>
   <span class="n">ndattribute</span><span class="o">=</span><span class="s2">&quot;calc1_val&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A value from the attributes file is only written
either in the <em>default location</em> or in the location named by
a <code class="docutils literal notranslate"><span class="pre">&lt;dataset/&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;attribute/&gt;</span></code> entry in the layout file.
Expect problems if you define the same <em>ndattribute</em>
in more than one place in the layout file.</p>
</div>
<p>You can control when a value is written to the file, using
<code class="docutils literal notranslate"><span class="pre">when=&quot;&quot;</span></code> in the layout file.  This can be set to one of these values:
<code class="docutils literal notranslate"><span class="pre">OnFileOpen</span></code>, <code class="docutils literal notranslate"><span class="pre">OnFileClose</span></code></p>
<p>Such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">dataset</span>
   <span class="n">name</span><span class="o">=</span><span class="s2">&quot;userCalc1&quot;</span>
   <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ndattribute&quot;</span>
   <span class="n">ndattribute</span><span class="o">=</span><span class="s2">&quot;calc1_val&quot;</span>
   <span class="n">when</span><span class="o">=</span><span class="s2">&quot;OnFileOpen&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">attribute</span>
   <span class="n">name</span><span class="o">=</span><span class="s2">&quot;exposure_s&quot;</span>
   <span class="n">source</span><span class="o">=</span><span class="s2">&quot;ndattribute&quot;</span>
   <span class="n">ndattribute</span><span class="o">=</span><span class="s2">&quot;AcquireTime&quot;</span>
   <span class="n">when</span><span class="o">=</span><span class="s2">&quot;OnFileClose&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<section id="additional-configuration">
<h3>additional configuration<a class="headerlink" href="#additional-configuration" title="Link to this heading">¶</a></h3>
<p>Additional configurations of the EPICS Area Detector and the HDF5 File Plugin
are done using the EPICS screens (shown here using caQtDM <a class="footnote-reference brackets" href="#id18" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>):</p>
<figure class="align-default" id="id24">
<a class="reference internal image-reference" href="../../_images/screen2.png"><img alt="configuration screens" src="../../_images/screen2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-text"><strong>ADBase</strong> and <strong>NDFileHDF5</strong> configuration screens</span><a class="headerlink" href="#id24" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Additional configuration on the <strong>ADBase</strong> screen:</p>
<ul class="simple">
<li><p>Set <em>Image mode</em> to “Single”</p></li>
<li><p>Set <em>Exposure time</em> as you wish</p></li>
<li><p>Set <em># Images</em> to 1</p></li>
<li><p>for testing, it is common to bin the data to reduce the image size</p></li>
<li><p>The full path to the <code class="docutils literal notranslate"><span class="pre">attributes.xml</span></code> file goes in the bottom/left <strong>File</strong> box</p></li>
</ul>
<p>Additional configuration on the <strong>NDFileHDF5</strong> screen:</p>
<ul class="simple">
<li><p>Set the <strong>File path</strong> and “File name” to your choice.</p></li>
<li><p>Set <strong>Auto save</strong> to “Yes”.</p></li>
<li><p>Set <strong>Compression</strong> to “zlib” if you wish (optional)</p></li>
<li><p>Set <strong>Enable</strong> to “Enable” or the HDF5 plugin won’t get images to write!</p></li>
<li><p>Set <strong>Callbacks block</strong> to “Yes” if you want to wait for HDF5 files to finish writing before collecting the next image</p></li>
<li><p>The full path to the <code class="docutils literal notranslate"><span class="pre">layout.xml</span></code> file goes into the bottom/right <strong>XML File name</strong> box</p></li>
<li><p>Leave the <strong>Attributes file</strong> box empty in this screen.</p></li>
</ul>
<p>When you enter the names of these files in the configuration screen
boxes, AreaDetector will check the files for errors and let you know.</p>
</section>
<section id="example-view">
<h3>Example view<a class="headerlink" href="#example-view" title="Link to this heading">¶</a></h3>
<p>We collected data for one image, <code class="docutils literal notranslate"><span class="pre">/tmp/mrinal_001.h5</span></code>, in the
HDF5 file provided in the <strong>downloads</strong> section.
You may notice that the values for <code class="docutils literal notranslate"><span class="pre">calc1_val</span></code> and <code class="docutils literal notranslate"><span class="pre">calc2_val</span></code>
were arrays rather than single values.  That was due to an error in the original
<code class="docutils literal notranslate"><span class="pre">attributes.xml</span></code> file, which had <code class="docutils literal notranslate"><span class="pre">type=&quot;PARAM&quot;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">type=&quot;EPICS_PV&quot;</span></code>.
This has been fixed in the <code class="docutils literal notranslate"><span class="pre">attributes.xml</span></code> file presented here.</p>
</section>
</section>
<section id="validate-the-xml-files">
<span id="epics-area-detector-examples-validate-xml"></span><h2><span class="section-number">2.3.2.4. </span>Validate the XML files<a class="headerlink" href="#validate-the-xml-files" title="Link to this heading">¶</a></h2>
<p>To validate an XML file, you’ll need the associated <code class="docutils literal notranslate"><span class="pre">.xsd</span></code> (XML Schema) file,
then use this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xmllint</span> <span class="o">--</span><span class="n">noout</span> <span class="o">--</span><span class="n">schema</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">schema</span><span class="o">/</span><span class="n">file</span><span class="o">.</span><span class="n">xsd</span>  <span class="n">file_to_validate</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>These are the XML Schema files to use:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>to validate …</p></th>
<th class="head"><p>… use this XML Schema file</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">attributes.xml</span></code></p></td>
<td><p><a class="reference external" href="https://github.com/areaDetector/ADCore/blob/master/XML_schema/NDAttributes.xsd">NDAttributes.xsd</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">layout.xml</span></code></p></td>
<td><p><a class="reference external" href="https://github.com/areaDetector/ADCore/blob/master/XML_schema/hdf5_xml_layout_schema.xsd">hdf5_xml_layout_schema.xsd</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nxdl.xsd</span></code></p></td>
<td><p><a class="reference external" href="https://www.w3.org/2012/04/XMLSchema.xsd">XMLSchema.xsd</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nxdlTypes.xsd</span></code></p></td>
<td><p><a class="reference external" href="https://www.w3.org/2012/04/XMLSchema.xsd">XMLSchema.xsd</a></p></td>
</tr>
<tr class="row-even"><td><p>any NXDL file</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nxdl.xsd</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="python-code-to-store-an-image-in-a-nexus-file">
<span id="epics-area-detector-examples-python"></span><h2><span class="section-number">2.3.2.5. </span>Python code to store an image in a NeXus file<a class="headerlink" href="#python-code-to-store-an-image-in-a-nexus-file" title="Link to this heading">¶</a></h2>
<p>Suppose you want to write area detector images into NeXus HDF5
files python code.  Let’s assume
you have the image already in memory in a numpy array, perhaps from
reading a TIFF file or from an EPICS PV using PyEpics.  The file
<code class="docutils literal notranslate"><span class="pre">write_nexus_file.py</span></code> (provided below) reads an image from the sim
detector and writes it to a NeXus HDF5 data file, along with some
additional metadata.</p>
<section id="using-the-h5py-package">
<h3>using the <em>h5py</em> package<a class="headerlink" href="#using-the-h5py-package" title="Link to this heading">¶</a></h3>
<p>This example uses the <em>h5py</em> <a class="footnote-reference brackets" href="#id19" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a> package to write the HDF5 file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos"> 2</span><span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="linenos"> 3</span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span><span class="w"> </span><span class="nf">write_nexus_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="p">{}):</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 7</span><span class="sd">    write the image to a NeXus HDF5 data file</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="sd">    Parameters</span>
<span class="linenos">10</span><span class="sd">    ----------</span>
<span class="linenos">11</span><span class="sd">    fname : str</span>
<span class="linenos">12</span><span class="sd">        name of the file (relative or absolute) to be written</span>
<span class="linenos">13</span><span class="sd">    image : numpy array</span>
<span class="linenos">14</span><span class="sd">        the image data</span>
<span class="linenos">15</span><span class="sd">    md : dictionary</span>
<span class="linenos">16</span><span class="sd">        key: value where value is something that can be written by h5py</span>
<span class="linenos">17</span><span class="sd">             (such as str, int, float, numpy array, ...)</span>
<span class="linenos">18</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">19</span>    <span class="n">nexus</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="linenos">20</span>    <span class="n">nexus</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fname</span>
<span class="linenos">21</span>    <span class="n">nexus</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;file_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">astimezone</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<span class="linenos">22</span>    <span class="n">nexus</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;creator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;write_nexus_file()&quot;</span>
<span class="linenos">23</span>    <span class="n">nexus</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;H5PY_VERSION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">__version__</span>
<span class="linenos">24</span>
<span class="linenos">25</span>    <span class="c1"># /entry</span>
<span class="linenos">26</span>    <span class="n">nxentry</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;entry&quot;</span><span class="p">)</span>
<span class="linenos">27</span>    <span class="n">nxentry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXentry&quot;</span>
<span class="linenos">28</span>    <span class="n">nexus</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nxentry</span><span class="o">.</span><span class="n">name</span>
<span class="linenos">29</span>
<span class="linenos">30</span>    <span class="c1"># /entry/instrument</span>
<span class="linenos">31</span>    <span class="n">nxinstrument</span> <span class="o">=</span> <span class="n">nxentry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;instrument&quot;</span><span class="p">)</span>
<span class="linenos">32</span>    <span class="n">nxinstrument</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXinstrument&quot;</span>
<span class="linenos">33</span>
<span class="linenos">34</span>    <span class="c1"># /entry/instrument/detector</span>
<span class="linenos">35</span>    <span class="n">nxdetector</span> <span class="o">=</span> <span class="n">nxinstrument</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;detector&quot;</span><span class="p">)</span>
<span class="linenos">36</span>    <span class="n">nxdetector</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXdetector&quot;</span>
<span class="linenos">37</span>
<span class="linenos">38</span>    <span class="c1"># /entry/instrument/detector/image</span>
<span class="linenos">39</span>    <span class="n">ds</span> <span class="o">=</span> <span class="n">nxdetector</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
<span class="linenos">40</span>    <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;counts&quot;</span>
<span class="linenos">41</span>    <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/entry/instrument/detector/image&quot;</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="c1"># /entry/data</span>
<span class="linenos">44</span>    <span class="n">nxdata</span> <span class="o">=</span> <span class="n">nxentry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="linenos">45</span>    <span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXdata&quot;</span>
<span class="linenos">46</span>    <span class="n">nxentry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nxdata</span><span class="o">.</span><span class="n">name</span>
<span class="linenos">47</span>
<span class="linenos">48</span>    <span class="c1"># /entry/data/data --&gt; /entry/instrument/detector/image</span>
<span class="linenos">49</span>    <span class="n">nxdata</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nexus</span><span class="p">[</span><span class="s2">&quot;/entry/instrument/detector/image&quot;</span><span class="p">]</span>
<span class="linenos">50</span>    <span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>
<span class="linenos">51</span>
<span class="linenos">52</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">md</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">53</span>        <span class="c1"># /entry/instrument/metadata (optional, for metadata)</span>
<span class="linenos">54</span>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">nxinstrument</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
<span class="linenos">55</span>        <span class="n">metadata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NXcollection&quot;</span>
<span class="linenos">56</span>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">md</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">57</span>            <span class="k">try</span><span class="p">:</span>
<span class="linenos">58</span>                <span class="n">metadata</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
<span class="linenos">59</span>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<span class="linenos">60</span>                <span class="n">metadata</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="linenos">61</span>
<span class="linenos">62</span>    <span class="n">nexus</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos">63</span>
<span class="linenos">64</span>    
<span class="linenos">65</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">66</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;demonstrate how to use this code&quot;&quot;&quot;</span>
<span class="linenos">67</span>    <span class="kn">import</span><span class="w"> </span><span class="nn">epics</span>
<span class="linenos">68</span>    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;13SIM1:&quot;</span>
<span class="linenos">69</span>    <span class="n">img</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;image1:ArrayData&quot;</span><span class="p">)</span>
<span class="linenos">70</span>    <span class="n">size_x</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;cam1:ArraySizeX_RBV&quot;</span><span class="p">)</span>
<span class="linenos">71</span>    <span class="n">size_y</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;cam1:ArraySizeY_RBV&quot;</span><span class="p">)</span>
<span class="linenos">72</span>    <span class="c1"># edit the full image for just the binned data</span>
<span class="linenos">73</span>    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:</span><span class="n">size_x</span><span class="o">*</span><span class="n">size_y</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">size_x</span><span class="p">,</span> <span class="n">size_y</span><span class="p">))</span>
<span class="linenos">74</span>
<span class="linenos">75</span>    <span class="n">extra_information</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="linenos">76</span>        <span class="n">unique_id</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;image1:UniqueId_RBV&quot;</span><span class="p">),</span>
<span class="linenos">77</span>        <span class="n">size_x</span> <span class="o">=</span> <span class="n">size_x</span><span class="p">,</span>
<span class="linenos">78</span>        <span class="n">size_y</span> <span class="o">=</span> <span class="n">size_y</span><span class="p">,</span>
<span class="linenos">79</span>        <span class="n">detector_state</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;cam1:DetectorState_RBV&quot;</span><span class="p">),</span>
<span class="linenos">80</span>        <span class="n">bitcoin_value</span><span class="o">=</span><span class="s2">&quot;15000&quot;</span><span class="p">,</span>
<span class="linenos">81</span>    <span class="p">)</span>
<span class="linenos">82</span>    <span class="n">write_nexus_file</span><span class="p">(</span><span class="s2">&quot;example.h5&quot;</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="n">extra_information</span><span class="p">)</span>
</pre></div>
</div>
<p>The output from that code is given in the
example.h5 file.  It has this tree structure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>example.h5 : NeXus data file
<span class="linenos"> 2</span>  @H5PY_VERSION = &quot;3.6.0&quot;
<span class="linenos"> 3</span>  @creator = &quot;write_nexus_file()&quot;
<span class="linenos"> 4</span>  @default = &quot;entry&quot;
<span class="linenos"> 5</span>  @file_time = &quot;2022-03-07 14:34:04.418733&quot;
<span class="linenos"> 6</span>  @filename = &quot;example.h5&quot;
<span class="linenos"> 7</span>  entry:NXentry
<span class="linenos"> 8</span>    @NX_class = &quot;NXentry&quot;
<span class="linenos"> 9</span>    @default = &quot;data&quot;
<span class="linenos">10</span>    data:NXdata
<span class="linenos">11</span>      @NX_class = &quot;NXdata&quot;
<span class="linenos">12</span>      @signal = &quot;data&quot;
<span class="linenos">13</span>      data --&gt; /entry/instrument/detector/image
<span class="linenos">14</span>    instrument:NXinstrument
<span class="linenos">15</span>      @NX_class = &quot;NXinstrument&quot;
<span class="linenos">16</span>      detector:NXdetector
<span class="linenos">17</span>        @NX_class = &quot;NXdetector&quot;
<span class="linenos">18</span>        image:NX_UINT8[1024,1024] = __array
<span class="linenos">19</span>          __array = [
<span class="linenos">20</span>              [76, 77, 78, &#39;...&#39;, 75]
<span class="linenos">21</span>              [77, 78, 79, &#39;...&#39;, 76]
<span class="linenos">22</span>              [78, 79, 80, &#39;...&#39;, 77]
<span class="linenos">23</span>              ...
<span class="linenos">24</span>              [75, 76, 77, &#39;...&#39;, 74]
<span class="linenos">25</span>            ]
<span class="linenos">26</span>          @target = &quot;/entry/instrument/detector/image&quot;
<span class="linenos">27</span>          @units = &quot;counts&quot;
<span class="linenos">28</span>      metadata:NXcollection
<span class="linenos">29</span>        @NX_class = &quot;NXcollection&quot;
<span class="linenos">30</span>        bitcoin_value:NX_CHAR = b&#39;15000&#39;
<span class="linenos">31</span>        detector_state:NX_INT64[] = 
<span class="linenos">32</span>        size_x:NX_INT64[] = 
<span class="linenos">33</span>        size_y:NX_INT64[] = 
<span class="linenos">34</span>        unique_id:NX_INT64[] = 
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Alternatively, the metadata shown in this example might
be placed in the <code class="docutils literal notranslate"><span class="pre">/entry/instrument/detector</span></code> (<em>NXdetector</em>)
group along with the image <code class="docutils literal notranslate"><span class="pre">data</span></code>
since it provides image-related information such as size.</p>
<p>In the interest of keeping this example simpler and similar to the one
above using the HDF5 File Writing Plugin, the metadata has been
written into a <em>NXcollection</em> group at <code class="docutils literal notranslate"><span class="pre">/entry/instrument/metadata</span></code> location.
(Compare with the <em>NXcollection</em> group  <code class="docutils literal notranslate"><span class="pre">/entry/instrument/NDAttributes</span></code> above.)</p>
</div>
</section>
<section id="using-the-nexusformat-package">
<h3>using the <em>nexusformat</em> package<a class="headerlink" href="#using-the-nexusformat-package" title="Link to this heading">¶</a></h3>
<p>The <em>nexusformat</em> <a class="footnote-reference brackets" href="#id20" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a> package for python simplifies
the work to create a NeXus file.  Rewriting the above code
using <em>nexusformat</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">nexusformat.nexus</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span><span class="w"> </span><span class="nf">write_nexus_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="p">{}):</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 7</span><span class="sd">    write the image to a NeXus HDF5 data file</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="sd">    Parameters</span>
<span class="linenos">10</span><span class="sd">    ----------</span>
<span class="linenos">11</span><span class="sd">    fname : str</span>
<span class="linenos">12</span><span class="sd">        name of the file (relative or absolute) to be written</span>
<span class="linenos">13</span><span class="sd">    image : numpy array</span>
<span class="linenos">14</span><span class="sd">        the image data</span>
<span class="linenos">15</span><span class="sd">    md : dictionary</span>
<span class="linenos">16</span><span class="sd">        key: value where value is something that can be written by h5py</span>
<span class="linenos">17</span><span class="sd">             (such as str, int, float, numpy array, ...)</span>
<span class="linenos">18</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">19</span>    <span class="n">nx</span> <span class="o">=</span> <span class="n">NXroot</span><span class="p">()</span>
<span class="linenos">20</span>    <span class="n">nx</span><span class="p">[</span><span class="s1">&#39;/entry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NXentry</span><span class="p">(</span><span class="n">NXinstrument</span><span class="p">(</span><span class="n">NXdetector</span><span class="p">()))</span>
<span class="linenos">21</span>    <span class="n">nx</span><span class="p">[</span><span class="s1">&#39;entry/instrument/detector/image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NXfield</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">,</span>
<span class="linenos">22</span>                                                    <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
<span class="linenos">23</span>    <span class="n">nx</span><span class="p">[</span><span class="s1">&#39;entry/data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NXdata</span><span class="p">()</span>
<span class="linenos">24</span>    <span class="n">nx</span><span class="p">[</span><span class="s1">&#39;entry/data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">makelink</span><span class="p">(</span><span class="n">nx</span><span class="p">[</span><span class="s1">&#39;entry/instrument/detector/image&#39;</span><span class="p">])</span>
<span class="linenos">25</span>    <span class="n">nx</span><span class="p">[</span><span class="s1">&#39;entry/data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nxsignal</span> <span class="o">=</span> <span class="n">nx</span><span class="p">[</span><span class="s1">&#39;entry/data/image&#39;</span><span class="p">]</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">md</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="c1"># /entry/instrument/metadata (optional, for metadata)</span>
<span class="linenos">29</span>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">nx</span><span class="p">[</span><span class="s1">&#39;/entry/instrument/metadata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NXcollection</span><span class="p">()</span>
<span class="linenos">30</span>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">md</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">31</span>            <span class="n">metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="n">nx</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="linenos">34</span>
<span class="linenos">35</span>    
<span class="linenos">36</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">37</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;demonstrate how to use this code&quot;&quot;&quot;</span>
<span class="linenos">38</span>    <span class="kn">import</span><span class="w"> </span><span class="nn">epics</span>
<span class="linenos">39</span>    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;13SIM1:&quot;</span>
<span class="linenos">40</span>    <span class="n">img</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;image1:ArrayData&quot;</span><span class="p">)</span>
<span class="linenos">41</span>    <span class="n">size_x</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;cam1:ArraySizeX_RBV&quot;</span><span class="p">)</span>
<span class="linenos">42</span>    <span class="n">size_y</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;cam1:ArraySizeY_RBV&quot;</span><span class="p">)</span>
<span class="linenos">43</span>    <span class="c1"># edit the full image for just the binned data</span>
<span class="linenos">44</span>    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:</span><span class="n">size_x</span><span class="o">*</span><span class="n">size_y</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">size_x</span><span class="p">,</span> <span class="n">size_y</span><span class="p">))</span>
<span class="linenos">45</span>
<span class="linenos">46</span>    <span class="n">extra_information</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="linenos">47</span>        <span class="n">unique_id</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;image1:UniqueId_RBV&quot;</span><span class="p">),</span>
<span class="linenos">48</span>        <span class="n">size_x</span> <span class="o">=</span> <span class="n">size_x</span><span class="p">,</span>
<span class="linenos">49</span>        <span class="n">size_y</span> <span class="o">=</span> <span class="n">size_y</span><span class="p">,</span>
<span class="linenos">50</span>        <span class="n">detector_state</span> <span class="o">=</span> <span class="n">epics</span><span class="o">.</span><span class="n">caget</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;cam1:DetectorState_RBV&quot;</span><span class="p">),</span>
<span class="linenos">51</span>        <span class="n">bitcoin_value</span><span class="o">=</span><span class="s2">&quot;15000&quot;</span><span class="p">,</span>
<span class="linenos">52</span>    <span class="p">)</span>
<span class="linenos">53</span>    <span class="n">write_nexus_file</span><span class="p">(</span><span class="s2">&quot;example.h5&quot;</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="n">extra_information</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="visualization">
<h2><span class="section-number">2.3.2.6. </span>Visualization<a class="headerlink" href="#visualization" title="Link to this heading">¶</a></h2>
<p>You can visualize the HDF5 files with several programs, such as:
hdfview <a class="footnote-reference brackets" href="#id21" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a>, nexpy <a class="footnote-reference brackets" href="#id22" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a>, or pymca <a class="footnote-reference brackets" href="#id23" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a>.
Views of the test image shown using <strong>NeXPy</strong> (from the HDF5 file)
and <strong>caQtDM</strong> (the image from EPICS) are shown.</p>
<figure class="align-default" id="id25">
<a class="reference internal image-reference" href="../../_images/screen1.png"><img alt="visualization screens" src="../../_images/screen1.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-text">Views of the image in <strong>NeXPy</strong> (left) and in <strong>caQtDM</strong> (right)</span><a class="headerlink" href="#id25" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Get the installation instructions for any of these programs
from a web search.  Other
data analysis programs such as MatLab, IgorPro, and IDL can
also read HDF5 files but you might have to work a bit more to
get the data to a plot.</p>
</section>
<section id="downloads">
<h2><span class="section-number">2.3.2.7. </span>Downloads<a class="headerlink" href="#downloads" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>file</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/1937642b9af657d29b9267f91b81136f/attributes.xml"><code class="xref download docutils literal notranslate"><span class="pre">attributes.xml</span></code></a></p></td>
<td><p>The attributes file</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/519a152115298cc7ab33718a49a8f4a5/layout.xml"><code class="xref download docutils literal notranslate"><span class="pre">layout.xml</span></code></a></p></td>
<td><p>The layout file</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/2369107dda331106afc31515a2026299/mrinal_001.h5"><code class="xref download docutils literal notranslate"><span class="pre">mrinal_001.h5</span></code></a></p></td>
<td><p>example NeXus HDF5 file written from EPICS</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/dfc22f4a37f3414e5e8cc7135510b802/write_nexus_file.py"><code class="xref download docutils literal notranslate"><span class="pre">write_nexus_file.py</span></code></a></p></td>
<td><p>Python code to get images from EPICS and write a NeXus file</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/0a877a94f6f32b982b9a0c74073f6f01/write_nexus_file2.py"><code class="xref download docutils literal notranslate"><span class="pre">write_nexus_file2.py</span></code></a></p></td>
<td><p><cite>write_nexus_file.py</cite> rewritten with <cite>nexusformat</cite> package</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/dcf7821a1ace82849c5a48749c787dac/example.h5"><code class="xref download docutils literal notranslate"><span class="pre">example.h5</span></code></a></p></td>
<td><p>example NeXus HDF5 file written from Python</p></td>
</tr>
</tbody>
</table>
</section>
<section id="footnotes">
<h2><span class="section-number">2.3.2.8. </span>Footnotes<a class="headerlink" href="#footnotes" title="Link to this heading">¶</a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id13" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>EPICS: <a class="reference external" href="https://epics-controls.org/">https://epics-controls.org/</a></p>
</aside>
<aside class="footnote brackets" id="id14" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>EPICS Area Detector: <a class="reference external" href="https://areadetector.github.io/master/index.html">https://areadetector.github.io/master/index.html</a></p>
</aside>
<aside class="footnote brackets" id="id15" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>HDF5 File Writer: <a class="reference external" href="https://areadetector.github.io/master/ADCore/NDFileHDF5.html">https://areadetector.github.io/master/ADCore/NDFileHDF5.html</a></p>
</aside>
<aside class="footnote brackets" id="id16" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>EPICS SimDetector: <a class="reference external" href="https://github.com/areaDetector/ADSimDetector">https://github.com/areaDetector/ADSimDetector</a></p>
</aside>
<aside class="footnote brackets" id="id17" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>NeXus manual: <a class="reference external" href="https://manual.nexusformat.org/">https://manual.nexusformat.org/</a></p>
</aside>
<aside class="footnote brackets" id="id18" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">6</a><span class="fn-bracket">]</span></span>
<p>caQtDM: <a class="reference external" href="http://epics.web.psi.ch/software/caqtdm/">http://epics.web.psi.ch/software/caqtdm/</a></p>
</aside>
<aside class="footnote brackets" id="id19" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">7</a><span class="fn-bracket">]</span></span>
<p>h5py: <a class="reference external" href="http://docs.h5py.org">http://docs.h5py.org</a></p>
</aside>
<aside class="footnote brackets" id="id20" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">8</a><span class="fn-bracket">]</span></span>
<p>nexusformat: This Python package is described on the NeXPy web site</p>
</aside>
<aside class="footnote brackets" id="id21" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">9</a><span class="fn-bracket">]</span></span>
<p>hdfview: <a class="reference external" href="https://support.hdfgroup.org/products/java/hdfview/">https://support.hdfgroup.org/products/java/hdfview/</a></p>
</aside>
<aside class="footnote brackets" id="id22" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">10</a><span class="fn-bracket">]</span></span>
<p>nexpy: <a class="reference external" href="https://nexpy.github.io/nexpy/">https://nexpy.github.io/nexpy/</a></p>
</aside>
<aside class="footnote brackets" id="id23" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">11</a><span class="fn-bracket">]</span></span>
<p>pymca: <a class="reference external" href="http://pymca.sourceforge.net/">http://pymca.sourceforge.net/</a></p>
</aside>
</aside>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">2.3.2. EPICS Area Detector Examples</a><ul>
<li><a class="reference internal" href="#hdf5-file-writing-plugin">2.3.2.1. HDF5 File Writing Plugin</a><ul>
<li><a class="reference internal" href="#configuration-files">configuration files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attributes-xml">2.3.2.2. <code class="docutils literal notranslate"><span class="pre">attributes.xml</span></code></a></li>
<li><a class="reference internal" href="#layout-xml">2.3.2.3. <code class="docutils literal notranslate"><span class="pre">layout.xml</span></code></a><ul>
<li><a class="reference internal" href="#additional-configuration">additional configuration</a></li>
<li><a class="reference internal" href="#example-view">Example view</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validate-the-xml-files">2.3.2.4. Validate the XML files</a></li>
<li><a class="reference internal" href="#python-code-to-store-an-image-in-a-nexus-file">2.3.2.5. Python code to store an image in a NeXus file</a><ul>
<li><a class="reference internal" href="#using-the-h5py-package">using the <em>h5py</em> package</a></li>
<li><a class="reference internal" href="#using-the-nexusformat-package">using the <em>nexusformat</em> package</a></li>
</ul>
</li>
<li><a class="reference internal" href="#visualization">2.3.2.6. Visualization</a></li>
<li><a class="reference internal" href="#downloads">2.3.2.7. Downloads</a></li>
<li><a class="reference internal" href="#footnotes">2.3.2.8. Footnotes</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../lrmecs/index.html"
                          title="previous chapter"><span class="section-number">2.3.1. </span>Viewing 2-D Data from LRMECS</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../../ref_doc.html"
                          title="next chapter"><span class="section-number">3. </span>NeXus: Reference Documentation</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <p>Have a Question? <a href="https://github.com/nexusformat/definitions/issues/new">Get help</a></p>
    <ul class="this-page-menu">
    <style>
		  .avatar-container {
		    display: flex;
		    align-items: center;
		  }
		
		  .avatar {
		    width: 32px;
		    height: 32px;
		    border-radius: 50%;
		    margin-right: 5px;
		  }
		</style>
		
    
    
		<div class="avatar-container">
      
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
<div id="google_search" style="display: none">
	<hr />
	<h3>Google search</h3>
	<form method="get" action="https://www.google.com/search">
		<table border="0" align="center" cellpadding="0">
			<tr>
				<td>
					<input type="text"   name="q" value="" />
				</td>
			</tr>
			<tr>
				<td align="center" style="font-size:75%">
					<input type="radio"  name="sitesearch" value="" />global
					<input type="radio"  name="sitesearch"
						value="manual.nexusformat.org" 
						checked />NeXus manual
					<input type="submit" value="Go" />
					<br />
				</td>
			</tr>
		</table>
	</form>                                
</div>
<script type="text/javascript">$('#google_search').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../ref_doc.html" title="3. NeXus: Reference Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="../lrmecs/index.html" title="2.3.1. Viewing 2-D Data from LRMECS"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">nexus v2026.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">2. </span>Examples of writing and reading NeXus data files</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">2.3.2. </span>EPICS Area Detector Examples</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; <a href="../../copyright.html">Copyright</a> 1996-2026, NIAC, https://www.nexusformat.org.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>