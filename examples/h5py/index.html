



<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>2.1.2. Python Examples using h5py &#8212; nexus v2018.5 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/blockquote.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="h5py example writing the simplest NeXus data file" href="writer_1_3.html" />
    <link rel="prev" title="2.1.1. Example NeXus C programs using native HDF5 commands" href="../code_native.html" /> 
    <link rel="stylesheet" href="../../_static/blockquote.css" type="text/css" />

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="writer_1_3.html" title="h5py example writing the simplest NeXus data file"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../code_native.html" title="2.1.1. Example NeXus C programs using native HDF5 commands"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">nexus v2018.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">2. Examples of writing and reading NeXus data files</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.1.2. Python Examples using <code class="docutils literal notranslate"><span class="pre">h5py</span></code></a><ul>
<li><a class="reference internal" href="#writing-the-simplest-data-using-h5py">2.1.2.1. Writing the simplest data using <code class="docutils literal notranslate"><span class="pre">h5py</span></code></a></li>
<li><a class="reference internal" href="#complete-h5py-example-writing-and-reading-a-nexus-data-file">2.1.2.2. Complete <code class="docutils literal notranslate"><span class="pre">h5py</span></code> example writing and reading a NeXus data file</a><ul>
<li><a class="reference internal" href="#writing-the-hdf5-file-using-h5py">Writing the HDF5 file using <strong>h5py</strong></a></li>
<li><a class="reference internal" href="#reading-the-hdf5-file-using-h5py">Reading the HDF5 file using <strong>h5py</strong></a></li>
<li><a class="reference internal" href="#plotting-the-hdf5-file">Plotting the HDF5 file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#links-to-data-in-external-hdf5-files">2.1.2.3. Links to Data in External HDF5 Files</a><ul>
<li><a class="reference internal" href="#file-external-angles-hdf5">file: external_angles.hdf5</a></li>
<li><a class="reference internal" href="#file-external-counts-hdf5">file: external_counts.hdf5</a></li>
<li><a class="reference internal" href="#file-external-master-hdf5">file: external_master.hdf5</a></li>
<li><a class="reference internal" href="#source-code-externalexample-py">source code: externalExample.py</a></li>
<li><a class="reference internal" href="#downloads">downloads</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../code_native.html"
                        title="previous chapter">2.1.1. Example NeXus C programs using native HDF5 commands</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="writer_1_3.html"
                        title="next chapter"><code class="docutils literal notranslate"><span class="pre">h5py</span></code> example writing the simplest NeXus data file</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/examples/h5py/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div id="google_search" style="display: none">
	<hr />
	<h3>Google search</h3>
	<form method="get" action="http://www.google.com/search">
		<table border="0" align="center" cellpadding="0">
			<tr>
				<td>
					<input type="text"   name="q" value="" />
				</td>
			</tr>
			<tr>
				<td align="center" style="font-size:75%">
					<input type="radio"  name="sitesearch" value="" />global
					<input type="radio"  name="sitesearch"
						value="download.nexusformat.org" 
						checked />NeXus manual
					<input type="submit" value="Go" />
					<br />
				</td>
			</tr>
		</table>
	</form>                                
</div>
<script type="text/javascript">$('#google_search').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="python-examples-using-h5py">
<span id="example-h5py"></span><span id="index-0"></span><h1>2.1.2. Python Examples using <code class="docutils literal notranslate"><span class="pre">h5py</span></code><a class="headerlink" href="#python-examples-using-h5py" title="Permalink to this headline">¶</a></h1>
<p>One way to gain a quick familiarity with NeXus is to start working with some data. For at least the
first few examples in this section, we have a simple two-column set of 1-D data, collected as part of a
series of alignment scans by the APS USAXS instrument during the time it was stationed at
beam line 32ID. We will show how to write this
data using the Python language and the <code class="docutils literal notranslate"><span class="pre">h5py</span></code> package <a class="footnote-reference brackets" href="#id3" id="id1">1</a>
(<span class="target" id="index-1"></span>using  <code class="docutils literal notranslate"><span class="pre">h5py</span></code> calls directly rather than using the NeXus NAPI). The
actual data to be written was extracted (elsewhere) from a <code class="docutils literal notranslate"><span class="pre">spec</span></code> <a class="footnote-reference brackets" href="#id4" id="id2">2</a> data file
and read as a text block from a file by the Python source code.
Our examples will start with the simplest case and add only mild complexity with each new case
since these examples are meant for those who are unfamiliar with NeXus.</p>
<dl class="footnote brackets">
<dt class="label" id="id3"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><em>h5py</em>: <a class="reference external" href="http://code.google.com/p/h5py">http://code.google.com/p/h5py</a></p>
</dd>
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p><em>SPEC</em>: <a class="reference external" href="http://certif.com/spec.html">http://certif.com/spec.html</a></p>
</dd>
</dl>
<p>The data shown plotted in the next figure will be written to the NeXus HDF5 file
using only two NeXus base classes, <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> and <code class="docutils literal notranslate"><span class="pre">NXdata</span></code>, in the first example
and then minor variations on this structure in the next two examples.  The
data model is identical to the one in the <a class="reference internal" href="../../introduction.html#fig-simple-example"><span class="std std-ref">Introduction</span></a>
chapter except that the names will be different, as shown below:</p>
<div class="compound">
<div class="compound-first figure align-center" id="id9">
<a class="reference internal image-reference" href="../../_images/Simple.png"><img alt="simple data structure" src="../../_images/Simple.png" style="width: 60%;" /></a>
<p class="caption"><span class="caption-text">data structure, (from Introduction)</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
<p class="compound-middle rubric">our h5py example</p>
<div class="compound-middle highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>/entry:NXentry
    /mr_scan:NXdata
       /mr : float64[31]
       /I00 : int32[31]
</pre></div>
</td></tr></table></div>
<div class="compound-middle figure align-center" id="id10">
<span id="example-h5py-plot"></span><a class="reference internal image-reference" href="../../_images/s00008.png"><img alt="Example-H5py-Plot" src="../../_images/s00008.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text">plot of our <em>mr_scan</em></span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
<p class="compound-middle rubric">two-column data for our <em>mr_scan</em></p>
<div class="compound-last highlight-guess notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span>17.92608    1037
17.92591    1318
17.92575    1704
17.92558    2857
17.92541    4516
17.92525    9998
17.92508    23819
17.92491    31662
17.92475    40458
17.92458    49087
17.92441    56514
17.92425    63499
17.92408    66802
17.92391    66863
17.92375    66599
17.92358    66206
17.92341    65747
17.92325    65250
17.92308    64129
17.92291    63044
17.92275    60796
17.92258    56795
17.92241    51550
17.92225    43710
17.92208    29315
17.92191    19782
17.92175    12992
17.92158    6622
17.92141    4198
17.92125    2248
17.92108    1321
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="writing-the-simplest-data-using-h5py">
<h2>2.1.2.1. Writing the simplest data using <code class="docutils literal notranslate"><span class="pre">h5py</span></code><a class="headerlink" href="#writing-the-simplest-data-using-h5py" title="Permalink to this headline">¶</a></h2>
<p>These two examples show how to write the simplest data (above).
One example writes the data directly to the <a class="reference internal" href="../../classes/base_classes/NXdata.html#nxdata"><span class="std std-ref">NXdata</span></a> group
while the other example writes the data to <code class="docutils literal notranslate"><span class="pre">NXinstrument/NXdetector/data</span></code>
and then creates a soft link to that data in <code class="docutils literal notranslate"><span class="pre">NXdata</span></code>.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="writer_1_3.html"><code class="docutils literal notranslate"><span class="pre">h5py</span></code> example writing the simplest NeXus data file</a></li>
<li class="toctree-l1"><a class="reference internal" href="writer_2_1.html"><code class="docutils literal notranslate"><span class="pre">h5py</span></code> example writing a simple NeXus data file with links</a></li>
</ul>
</div>
</div>
<div class="section" id="complete-h5py-example-writing-and-reading-a-nexus-data-file">
<span id="example-h5py-complete"></span><h2>2.1.2.2. Complete <code class="docutils literal notranslate"><span class="pre">h5py</span></code> example writing and reading a NeXus data file<a class="headerlink" href="#complete-h5py-example-writing-and-reading-a-nexus-data-file" title="Permalink to this headline">¶</a></h2>
<div class="section" id="writing-the-hdf5-file-using-h5py">
<span id="example-h5py-writing"></span><h3>Writing the HDF5 file using <strong>h5py</strong><a class="headerlink" href="#writing-the-hdf5-file-using-h5py" title="Permalink to this headline">¶</a></h3>
<p>In the main code section of <a class="reference internal" href="#example-h5py-basicwriter"><span class="std std-ref">BasicWriter.py</span></a>,
a current time stamp
is written in the format of <em>ISO 8601</em> (<code class="docutils literal notranslate"><span class="pre">yyyy-mm-ddTHH:MM:SS</span></code>).
For simplicity of this code example, we use a text string for the time, rather than
computing it directly from Python support library calls.  It is easier this way to
see the exact type of string formatting for the time.  When using the Python
<code class="docutils literal notranslate"><span class="pre">datetime</span></code> package, one way to write the time stamp is:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The data (<code class="docutils literal notranslate"><span class="pre">mr</span></code> is similar to “two_theta” and
<code class="docutils literal notranslate"><span class="pre">I00</span></code> is similar to “counts”) is collated into two Python lists. We use the
<strong>numpy</strong> package to read the file and parse the two-column format.</p>
<p>The new HDF5 file is opened (and created if not already existing) for writing,
setting common NeXus attributes in the same command from our support library.
Proper HDF5+NeXus groups are created for <code class="docutils literal notranslate"><span class="pre">/entry:NXentry/mr_scan:NXdata</span></code>.
Since we are not using the NAPI, our
support library must create and set the <code class="docutils literal notranslate"><span class="pre">NX_class</span></code> attribute on each group.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We want to create the desired structure of
<code class="docutils literal notranslate"><span class="pre">/entry:NXentry/mr_scan:NXdata/</span></code>.</p>
<ol class="arabic simple">
<li><p>First, our support library calls
<code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">h5py.File()</span></code>
to create the file and root level NeXus structure.</p></li>
<li><p>Then, it calls
<code class="docutils literal notranslate"><span class="pre">nxentry</span> <span class="pre">=</span> <span class="pre">f.create_group(&quot;entry&quot;)</span></code>
to create the <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> group called
<code class="docutils literal notranslate"><span class="pre">entry</span></code> at the root level.</p></li>
<li><p>Then, it calls
<code class="docutils literal notranslate"><span class="pre">nxdata</span> <span class="pre">=</span> <span class="pre">nxentry.create_group(&quot;mr_scan&quot;)</span></code>
to create the <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> group called
<code class="docutils literal notranslate"><span class="pre">entry</span></code> as a child of the <code class="docutils literal notranslate"><span class="pre">NXentry</span></code> group.</p></li>
</ol>
</div>
<p>Next, we create a dataset called <code class="docutils literal notranslate"><span class="pre">title</span></code> to hold a title string that can
appear on the default plot.</p>
<p>Next, we create datasets for <code class="docutils literal notranslate"><span class="pre">mr</span></code> and <code class="docutils literal notranslate"><span class="pre">I00</span></code> using our support library.
The data type of each, as represented in <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, will be recognized by
<code class="docutils literal notranslate"><span class="pre">h5py</span></code> and automatically converted to the proper HDF5 type in the file.
A Python dictionary of attributes is given, specifying the engineering units and other
values needed by NeXus to provide a default plot of this data.  By setting <code class="docutils literal notranslate"><span class="pre">signal=&quot;I00&quot;</span></code>
as an attribute on the group, NeXus recognizes <code class="docutils literal notranslate"><span class="pre">I00</span></code> as the default
<em>y</em> axis for the plot.  The <code class="docutils literal notranslate"><span class="pre">axes=&quot;mr&quot;</span></code> attribute on the <a class="reference internal" href="../../classes/base_classes/NXdata.html#nxdata"><span class="std std-ref">NXdata</span></a>
group connects the dataset to be used as the <em>x</em> axis.</p>
<p>Finally, we <em>must</em> remember to call <code class="docutils literal notranslate"><span class="pre">f.close()</span></code> or we might
corrupt the file when the program quits.</p>
<div class="compound">
<p class="compound-first rubric"><em>BasicWriter.py</em>: Write a NeXus HDF5 file using Python with h5py</p>
<div class="compound-last highlight-guess notranslate" id="example-h5py-basicwriter"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&#39;&#39;&#39;Writes a NeXus HDF5 file using h5py and numpy&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">h5py</span>    <span class="c1"># HDF5 support</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Write a NeXus HDF5 file&quot;</span><span class="p">)</span>
<span class="n">fileName</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;prj_test.nexus.hdf5&quot;</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;2010-10-18T17:17:04-0500&quot;</span>

<span class="c1"># load data from two column format</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="kp">loadtxt</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;input.dat&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">mr_arr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">i00_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="kp">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>

<span class="c1"># create the HDF5 NeXus file</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="c1"># point to the default data to be plotted</span>
<span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;entry&#39;</span>
<span class="c1"># give the HDF5 root some more attributes</span>
<span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;file_name&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">fileName</span>
<span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;file_time&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">timestamp</span>
<span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;instrument&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;APS USAXS at 32ID-B&#39;</span>
<span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;creator&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;BasicWriter.py&#39;</span>
<span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;NeXus_version&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;4.3.0&#39;</span>
<span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;HDF5_Version&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">u</span><span class="p">(</span><span class="n">h5py</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">hdf5_version</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;h5py_version&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">u</span><span class="p">(</span><span class="n">h5py</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>

<span class="c1"># create the NXentry group</span>
<span class="n">nxentry</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;entry&#39;</span><span class="p">)</span>
<span class="n">nxentry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;NX_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;NXentry&#39;</span>
<span class="n">nxentry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;mr_scan&#39;</span>
<span class="n">nxentry</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;1-D scan of I00 v. mr&#39;</span><span class="p">)</span>

<span class="c1"># create the NXentry group</span>
<span class="n">nxdata</span> <span class="o">=</span> <span class="n">nxentry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;mr_scan&#39;</span><span class="p">)</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;NX_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;NXdata&#39;</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;signal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;I00&#39;</span>      <span class="c1"># Y axis of default plot</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;mr&#39;</span>         <span class="c1"># X axis of default plot</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;mr_indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,]</span>   <span class="c1"># use &quot;mr&quot; as the first dimension of I00</span>

<span class="c1"># X axis data</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">nxdata</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;mr&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mr_arr</span><span class="p">)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;degrees&#39;</span>
<span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;USAXS mr (degrees)&#39;</span>    <span class="c1"># suggested X axis plot label</span>

<span class="c1"># Y axis data</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">nxdata</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;I00&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">i00_arr</span><span class="p">)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;counts&#39;</span>
<span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;USAXS I00 (counts)&#39;</span>    <span class="c1"># suggested Y axis plot label</span>

<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>   <span class="c1"># be CERTAIN to close the file</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;wrote file:&quot;</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="reading-the-hdf5-file-using-h5py">
<span id="example-h5py-reading"></span><h3>Reading the HDF5 file using <strong>h5py</strong><a class="headerlink" href="#reading-the-hdf5-file-using-h5py" title="Permalink to this headline">¶</a></h3>
<p>The file reader, <a class="reference internal" href="#example-h5py-reader"><span class="std std-ref">BasicReader.py</span></a>,
is very simple since the bulk of the work is done by <code class="docutils literal notranslate"><span class="pre">h5py</span></code>.
Our code opens the HDF5 we wrote above,
prints the HDF5 attributes from the file, reads the two datasets,
and then prints them out as columns.  As simple as that.
Of course, real code might add some error-handling and
extracting other useful stuff from the file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See that we identified each of the two datasets using HDF5 absolute path references
(just using the group and dataset names). Also, while coding this example, we were reminded
that HDF5 is sensitive to upper or lowercase. That is, <code class="docutils literal notranslate"><span class="pre">I00</span></code> is not the same is
<code class="docutils literal notranslate"><span class="pre">i00</span></code>.</p>
</div>
<div class="compound">
<p class="compound-first rubric"><em>BasicReader.py</em>: Read a NeXus HDF5 file using Python with h5py</p>
<div class="compound-last highlight-guess notranslate" id="example-h5py-reader"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&#39;&#39;&#39;Reads NeXus HDF5 files using h5py and prints the contents&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">h5py</span>    <span class="c1"># HDF5 support</span>

<span class="n">fileName</span> <span class="o">=</span> <span class="s2">&quot;prj_test.nexus.hdf5&quot;</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span>  <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">item</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
<span class="n">mr</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;/entry/mr_scan/mr&#39;</span><span class="p">]</span>
<span class="n">i00</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;/entry/mr_scan/I00&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;mr&quot;</span><span class="p">,</span> <span class="s2">&quot;I00&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mr</span><span class="p">)):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i00</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Output from <code class="docutils literal notranslate"><span class="pre">BasicReader.py</span></code> is shown next.</p>
<div class="compound">
<p class="compound-first rubric">Output from <code class="docutils literal notranslate"><span class="pre">BasicReader.py</span></code></p>
<div class="compound-last highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span>file_name: prj_test.nexus.hdf5
file_time: 2010-10-18T17:17:04-0500
creator: BasicWriter.py
HDF5_Version: 1.8.5
NeXus_version: 4.3.0
h5py_version: 1.2.1
instrument: APS USAXS at 32ID-B
#   mr  I00
0   17.9261 1037
1   17.9259 1318
2   17.9258 1704
3   17.9256 2857
4   17.9254 4516
5   17.9252 9998
6   17.9251 23819
7   17.9249 31662
8   17.9247 40458
9   17.9246 49087
10  17.9244 56514
11  17.9243 63499
12  17.9241 66802
13  17.9239 66863
14  17.9237 66599
15  17.9236 66206
16  17.9234 65747
17  17.9232 65250
18  17.9231 64129
19  17.9229 63044
20  17.9228 60796
21  17.9226 56795
22  17.9224 51550
23  17.9222 43710
24  17.9221 29315
25  17.9219 19782
26  17.9217 12992
27  17.9216 6622
28  17.9214 4198
29  17.9213 2248
30  17.9211 1321
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="plotting-the-hdf5-file">
<span id="example-h5py-plotting"></span><h3>Plotting the HDF5 file<a class="headerlink" href="#plotting-the-hdf5-file" title="Permalink to this headline">¶</a></h3>
<p id="index-2">Now that we are certain our file conforms to the NeXus
standard, let’s plot it using the <code class="docutils literal notranslate"><span class="pre">NeXpy</span></code> <a class="footnote-reference brackets" href="#id6" id="id5">3</a>
client tool.  To help label the plot, we added the
<code class="docutils literal notranslate"><span class="pre">long_name</span></code> attributes to each of our datasets.
We also added metadata to the root level of our HDF5 file
similar to that written by the NAPI.  It seemed to be a useful addition.
Compare this with <a class="reference internal" href="#example-h5py-plot"><span class="std std-ref">plot of our mr_scan</span></a>
and note that the horizontal axis of this plot is mirrored from that above.
This is because the data is stored in the file in descending
<code class="docutils literal notranslate"><span class="pre">mr</span></code> order and <code class="docutils literal notranslate"><span class="pre">NeXpy</span></code> has plotted
it that way (in order of appearance) by default.</p>
<dl class="footnote brackets">
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id5">3</a></span></dt>
<dd><p><em>NeXpy</em>:    <a class="reference external" href="http://nexpy.github.io/nexpy/">http://nexpy.github.io/nexpy/</a></p>
</dd>
</dl>
<div class="compound">
<div class="compound-last figure align-center" id="id11">
<span id="fig-example-h5py-nexpy-plot"></span><a class="reference internal image-reference" href="../../_images/nexpy.png"><img alt="fig-Example-H5py-nexpy-plot" src="../../_images/nexpy.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-text">plot of our <em>mr_scan</em> using NeXpy</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
</div>
<div class="section" id="links-to-data-in-external-hdf5-files">
<span id="h5py-example-external-links"></span><h2>2.1.2.3. Links to Data in External HDF5 Files<a class="headerlink" href="#links-to-data-in-external-hdf5-files" title="Permalink to this headline">¶</a></h2>
<p>HDF5 files may contain links to data (or groups) in other files.
This can be used to advantage to refer to data in existing HDF5 files
and create NeXus-compliant data files.  Here, we show such an example,
using the same <code class="docutils literal notranslate"><span class="pre">counts</span></code> v. <code class="docutils literal notranslate"><span class="pre">two_theta</span></code> data from the examples above.</p>
<p>We use the <em>HDF5 external file</em> links with NeXus data files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">[</span><span class="n">local_addr</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">ExternalLink</span><span class="p">(</span><span class="n">external_file_name</span><span class="p">,</span> <span class="n">external_addr</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">f</span></code> is an open <code class="docutils literal notranslate"><span class="pre">h5py.File()</span></code> object in which we will create the new link,
<code class="docutils literal notranslate"><span class="pre">local_addr</span></code> is an HDF5 path address, <code class="docutils literal notranslate"><span class="pre">external_file_name</span></code> is the name
(relative or absolute) of an existing HDF5 file, and <code class="docutils literal notranslate"><span class="pre">external_addr</span></code> is the
HDF5 path address of the existing data in the <code class="docutils literal notranslate"><span class="pre">external_file_name</span></code> to be linked.</p>
<div class="section" id="file-external-angles-hdf5">
<h3>file: external_angles.hdf5<a class="headerlink" href="#file-external-angles-hdf5" title="Permalink to this headline">¶</a></h3>
<p>Take for example, the structure of <a class="reference download internal" download="" href="../../_downloads/d13fc8d53468dfd2cf0e9dc97c0530d5/external_angles.hdf5"><code class="xref download docutils literal notranslate"><span class="pre">external_angles.hdf5</span></code></a>,
a simple HDF5 data file that contains just the <code class="docutils literal notranslate"><span class="pre">two_theta</span></code>
angles in an HDF5 dataset at the root level of the file.
Although this is a valid HDF5 data file, it is not a valid NeXus data file:</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>angles:float64[31] = [17.926079999999999, &#39;...&#39;, 17.92108]
  @units = degrees
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="file-external-counts-hdf5">
<h3>file: external_counts.hdf5<a class="headerlink" href="#file-external-counts-hdf5" title="Permalink to this headline">¶</a></h3>
<p>The data in the file <code class="docutils literal notranslate"><span class="pre">external_angles.hdf5</span></code> might be referenced from
another HDF5 file (such as <a class="reference download internal" download="" href="../../_downloads/51fb579516c13a3a4cd7046b4f7bb40e/external_counts.hdf5"><code class="xref download docutils literal notranslate"><span class="pre">external_counts.hdf5</span></code></a>)
by an HDF5 external link. <a class="footnote-reference brackets" href="#id8" id="id7">4</a>
Here is an example of the structure:</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>entry:NXentry
  instrument:NXinstrument
  detector:NXdetector
    counts:NX_INT32[31] = [1037, &#39;...&#39;, 1321]
      @units = counts
    two_theta --&gt; file=&quot;external_angles.hdf5&quot;, path=&quot;/angles&quot;
</pre></div>
</td></tr></table></div>
<dl class="footnote brackets">
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id7">4</a></span></dt>
<dd><p>see these URLs for further guidance on HDF5 external links:
<a class="reference external" href="http://www.hdfgroup.org/HDF5/doc/RM/RM_H5L.html#Link-CreateExternal">http://www.hdfgroup.org/HDF5/doc/RM/RM_H5L.html#Link-CreateExternal</a>,
<a class="reference external" href="http://www.h5py.org/docs-1.3/guide/group.html#external-links">http://www.h5py.org/docs-1.3/guide/group.html#external-links</a></p>
</dd>
</dl>
</div>
<div class="section" id="file-external-master-hdf5">
<h3>file: external_master.hdf5<a class="headerlink" href="#file-external-master-hdf5" title="Permalink to this headline">¶</a></h3>
<p>A valid NeXus data file could be created that refers to the data in these files
without making a copy of the data files themselves.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is necessary for all
these files to be located together in the same directory for the HDF5 external file
links to work properly.`</p>
</div>
<p>To be a valid NeXus file, it must contain a <a class="reference internal" href="../../classes/base_classes/NXentry.html#nxentry"><span class="std std-ref">NXentry</span></a> group.
For the files above, it is simple to make a master file that links to
the data we desire, from structure that we create.  We then add the
group attributes that describe the default plottable data:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>data:NXdata
  @signal = counts
  @axes = two_theta
  @two_theta_indices = 0
</pre></div>
</div>
<p>Here is (the basic structure of) <a class="reference download internal" download="" href="../../_downloads/e82a26bbffec57b9b5d5a2951b743f9c/external_master.hdf5"><code class="xref download docutils literal notranslate"><span class="pre">external_master.hdf5</span></code></a>, an example:</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>entry:NXentry
@default = data
  instrument --&gt; file=&quot;external_counts.hdf5&quot;, path=&quot;/entry/instrument&quot;
  data:NXdata
    @signal = counts
    @axes = two_theta
     @two_theta = 0
    counts --&gt; file=&quot;external_counts.hdf5&quot;, path=&quot;/entry/instrument/detector/counts&quot;
    two_theta --&gt; file=&quot;external_angles.hdf5&quot;, path=&quot;/angles&quot;
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="source-code-externalexample-py">
<h3>source code: externalExample.py<a class="headerlink" href="#source-code-externalexample-py" title="Permalink to this headline">¶</a></h3>
<p>Here is the complete code of a Python program, using <code class="docutils literal notranslate"><span class="pre">h5py</span></code>
to write a NeXus-compliant HDF5 file with links to data in other HDF5 files.</p>
<div class="compound">
<p class="compound-first rubric"><em>externalExample.py</em>: Write using HDF5 external links</p>
<div class="compound-last highlight-guess notranslate" id="example-h5py-externalexample"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Writes a NeXus HDF5 file using h5py with links to data in other HDF5 files.</span>

<span class="sd">This example is based on ``writer_2_1``.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="n">FILE_HDF5_MASTER</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;external_master.hdf5&quot;</span>
<span class="n">FILE_HDF5_ANGLES</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;external_angles.hdf5&quot;</span>
<span class="n">FILE_HDF5_COUNTS</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;external_counts.hdf5&quot;</span>

<span class="c1">#---------------------------</span>

<span class="c1"># get some data</span>
<span class="nb">buffer</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="kp">loadtxt</span><span class="p">(</span><span class="s2">&quot;input.dat&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">tthData</span> <span class="o">=</span> <span class="nb">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                             <span class="c1"># float[]</span>
<span class="n">countsData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="kp">asarray</span><span class="p">(</span><span class="nb">buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>   <span class="c1"># int[]</span>

<span class="c1"># put the angle data in an external (non-NeXus) HDF5 data file</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">FILE_HDF5_ANGLES</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;angles&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">tthData</span><span class="p">)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;degrees&quot;</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>    <span class="c1"># be CERTAIN to close the file</span>


<span class="c1"># put the detector counts in an external HDF5 data file </span>
<span class="c1"># with *incomplete* NeXus structure (no NXdata group)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">FILE_HDF5_COUNTS</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">nxentry</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;entry&quot;</span><span class="p">)</span>
<span class="n">nxentry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;NXentry&quot;</span>
<span class="n">nxinstrument</span> <span class="o">=</span> <span class="n">nxentry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;instrument&quot;</span><span class="p">)</span>
<span class="n">nxinstrument</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;NXinstrument&quot;</span>
<span class="n">nxdetector</span> <span class="o">=</span> <span class="n">nxinstrument</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;detector&quot;</span><span class="p">)</span>
<span class="n">nxdetector</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;NXdetector&quot;</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">nxdetector</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;counts&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">countsData</span><span class="p">)</span>
<span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;counts&quot;</span>
<span class="c1"># link the &quot;two_theta&quot; data stored in separate file</span>
<span class="n">local_addr</span> <span class="o">=</span> <span class="n">nxdetector</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="sa">u</span><span class="s2">&quot;/two_theta&quot;</span>
<span class="n">f</span><span class="p">[</span><span class="n">local_addr</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">ExternalLink</span><span class="p">(</span><span class="n">FILE_HDF5_ANGLES</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;/angles&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># create a master NeXus HDF5 file</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">FILE_HDF5_MASTER</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;entry&quot;</span>
<span class="n">nxentry</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;entry&quot;</span><span class="p">)</span>
<span class="n">nxentry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span><span class="sa">u</span><span class="s2">&quot;NXentry&quot;</span>
<span class="n">nxentry</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;data&quot;</span>
<span class="n">nxdata</span> <span class="o">=</span> <span class="n">nxentry</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;NXdata&quot;</span>

<span class="c1"># link in the signal data</span>
<span class="n">local_addr</span> <span class="o">=</span> <span class="s1">&#39;/entry/data/counts&#39;</span>
<span class="n">external_addr</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;/entry/instrument/detector/counts&quot;</span>
<span class="n">f</span><span class="p">[</span><span class="n">local_addr</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">ExternalLink</span><span class="p">(</span><span class="n">FILE_HDF5_COUNTS</span><span class="p">,</span> <span class="n">external_addr</span><span class="p">)</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;signal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;counts&quot;</span>

<span class="c1"># link in the axes data</span>
<span class="n">local_addr</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;/entry/data/two_theta&quot;</span>
<span class="n">f</span><span class="p">[</span><span class="n">local_addr</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">ExternalLink</span><span class="p">(</span><span class="n">FILE_HDF5_ANGLES</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;/angles&quot;</span><span class="p">)</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;axes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;two_theta&quot;</span>
<span class="n">nxdata</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="sa">u</span><span class="s2">&quot;two_theta_indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,]</span>

<span class="n">local_addr</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;/entry/instrument&quot;</span>
<span class="n">f</span><span class="p">[</span><span class="n">local_addr</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">ExternalLink</span><span class="p">(</span><span class="n">FILE_HDF5_COUNTS</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;/entry/instrument&quot;</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="downloads">
<h3>downloads<a class="headerlink" href="#downloads" title="Permalink to this headline">¶</a></h3>
<p>The Python code and files related to this section may be downloaded from the following table.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>file</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/c5c6372c6274911eef4aead35a3a142d/input.dat"><code class="xref download docutils literal notranslate"><span class="pre">input.dat</span></code></a></p></td>
<td><p>2-column ASCII data used in this section</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/040a3ce2f248276056c7f1ca7f84edca/BasicReader.py"><code class="xref download docutils literal notranslate"><span class="pre">BasicReader.py</span></code></a></p></td>
<td><p>python code to read example <em>prj_test.nexus.hdf5</em></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/b05923fcfe357f3c2e3d95d563d4cda5/BasicWriter.py"><code class="xref download docutils literal notranslate"><span class="pre">BasicWriter.py</span></code></a></p></td>
<td><p>python code to write example <em>prj_test.nexus.hdf5</em></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/e869ab8dc9679ca2a7715e1bfd02b0dc/external_angles_h5dump.txt"><code class="xref download docutils literal notranslate"><span class="pre">external_angles_h5dump.txt</span></code></a></p></td>
<td><p><em>h5dump</em> analysis of <em>external_angles.hdf5</em></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/d13fc8d53468dfd2cf0e9dc97c0530d5/external_angles.hdf5"><code class="xref download docutils literal notranslate"><span class="pre">external_angles.hdf5</span></code></a></p></td>
<td><p>HDF5 file written by <em>externalExample</em></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/e27eb247628a36e3c008126e8f4367e0/external_angles_structure.txt"><code class="xref download docutils literal notranslate"><span class="pre">external_angles_structure.txt</span></code></a></p></td>
<td><p><em>h5toText</em> analysis of <em>external_angles.hdf5</em></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/7d8c8b0b74ed9e619d47e09103ae74e9/external_counts_h5dump.txt"><code class="xref download docutils literal notranslate"><span class="pre">external_counts_h5dump.txt</span></code></a></p></td>
<td><p><em>h5dump</em> analysis of <em>external_counts.hdf5</em></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/51fb579516c13a3a4cd7046b4f7bb40e/external_counts.hdf5"><code class="xref download docutils literal notranslate"><span class="pre">external_counts.hdf5</span></code></a></p></td>
<td><p>HDF5 file written by <em>externalExample</em></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/c23b811919813c6b724574fd22e47f43/external_counts_structure.txt"><code class="xref download docutils literal notranslate"><span class="pre">external_counts_structure.txt</span></code></a></p></td>
<td><p><em>h5toText</em> analysis of <em>external_counts.hdf5</em></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/f393e4543ddb3d70f549c219fdfb8681/externalExample.py"><code class="xref download docutils literal notranslate"><span class="pre">externalExample.py</span></code></a></p></td>
<td><p>python code to write external linking examples</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/05971d85bb09ff0cc6252f4346a02986/external_master_h5dump.txt"><code class="xref download docutils literal notranslate"><span class="pre">external_master_h5dump.txt</span></code></a></p></td>
<td><p><em>h5dump</em> analysis of <em>external_master.hdf5</em></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/e82a26bbffec57b9b5d5a2951b743f9c/external_master.hdf5"><code class="xref download docutils literal notranslate"><span class="pre">external_master.hdf5</span></code></a></p></td>
<td><p>NeXus file written by <em>externalExample</em></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/7075340ea0b80245a16570847c2f0387/external_master_structure.txt"><code class="xref download docutils literal notranslate"><span class="pre">external_master_structure.txt</span></code></a></p></td>
<td><p><em>h5toText</em> analysis of <em>external_master.hdf5</em></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/11a4d9b6b2b661570ade108a2c2ef7db/prj_test.nexus_h5dump.txt"><code class="xref download docutils literal notranslate"><span class="pre">prj_test.nexus_h5dump.txt</span></code></a></p></td>
<td><p><em>h5dump</em> analysis of the NeXus file</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/fef15110adcce80fc944df7ae90fd96d/prj_test.nexus.hdf5"><code class="xref download docutils literal notranslate"><span class="pre">prj_test.nexus.hdf5</span></code></a></p></td>
<td><p>NeXus file written by <em>BasicWriter</em></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/d17d5f306b0ad6c22d9499d6a28cd2c4/prj_test.nexus_structure.txt"><code class="xref download docutils literal notranslate"><span class="pre">prj_test.nexus_structure.txt</span></code></a></p></td>
<td><p><em>h5toText</em> analysis of the NeXus file</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="writer_1_3.html" title="h5py example writing the simplest NeXus data file"
             >next</a> |</li>
        <li class="right" >
          <a href="../code_native.html" title="2.1.1. Example NeXus C programs using native HDF5 commands"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">nexus v2018.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >2. Examples of writing and reading NeXus data files</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../copyright.html">Copyright</a> 1996-2019, NIAC, https://nexusformat.org.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>